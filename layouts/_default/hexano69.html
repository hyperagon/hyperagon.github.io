<!DOCTYPE html>
<html lang="en">
<!--
Copyright (c) 2026 Hyperagon

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
-->
<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><title>Hexano 6.9</title><style type="text/css">body,html{margin:0;padding:0;width:100%;height:100%;overflow:hidden;background-color:#1a1a1a;color:#e0e0e0;font-family:Courier,CourierNew,sans-serif;font-weight:700;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-touch-callout:none}.app-container{display:flex;flex-direction:column;width:100%;height:100%}.hexboard-container{flex-grow:1;display:flex;justify-content:center;align-items:center;overflow:hidden;position:relative;width:100%;height:100%}.hexboard{display:block;transform-origin:center center;transition:transform .3s ease}.control-bar{flex-shrink:0;z-index:10;display:block;position:relative;padding:10px 20px;background-color:#2a2a2a;border-bottom:1px solid #000;text-align:center}.control-bar button,.control-bar select{background:0 0;border:none;color:#e0e0e0;cursor:pointer;font-size:16px;margin:0 5px;vertical-align:middle}.control-bar select{background-color:#333;border:1px solid #555;padding:5px}.control-bar input[type=range]{width:100px;cursor:pointer;vertical-align:middle}#record-button{width:32px;height:32px;border:2px solid #e0e0e0;border-radius:50%;display:inline-block;position:relative;transition:border-color .2s,box-shadow .3s}#record-button.recording{border-color:#ff4136;animation:pulse 1.5s infinite}#record-indicator{width:18px;height:18px;background-color:#ff4136;border-radius:50%;position:absolute;top:50%;left:50%;margin-top:-9px;margin-left:-9px;transform:scale(0);transition:transform .2s ease-in-out}#record-button.recording #record-indicator{transform:scale(1)}#fullscreen-button,#instrument-button,#play-button{width:32px;height:32px;padding:0;display:inline-block;vertical-align:middle;position:relative}.icon{width:100%;height:100%;fill:currentColor}.instrument-selector{position:relative;display:inline-block}.instrument-dropdown{position:absolute;top:100%;left:0;background-color:#333;border:1px solid #555;border-radius:5px;padding:5px 0;margin-top:5px;min-width:150px;display:none;z-index:100}.instrument-dropdown.active{display:block}.instrument-option{padding:8px 15px;cursor:pointer;display:flex;align-items:center}.instrument-option:hover{background-color:#444}.instrument-option.selected{background-color:#4a4a4a}.instrument-option .icon{width:20px;height:20px;margin-right:10px}.overlay-panel{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:600px;height:400px;background-color:#333;border:2px solid #555;border-radius:10px;z-index:1000;display:none;box-shadow:0 5px 25px rgba(0,0,0,.8);flex-direction:column;padding:20px;box-sizing:border-box}.overlay-panel.active{display:flex}.overlay-panel .close-btn{position:absolute;top:10px;right:10px;width:30px;height:30px;background-color:#555;border:none;border-radius:50%;color:#e0e0e0;font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center}.overlay-panel .close-btn:hover{background-color:#666}.panel-header{text-align:center;margin-bottom:10px}.panel-header h2{margin:0;padding:0}.panel-content{flex-grow:1;overflow-y:auto;background-color:#222;border-radius:5px;padding:10px;margin-bottom:15px}.note-list-header{display:flex;padding:5px 10px;border-bottom:2px solid #555;font-weight:700;color:#e0e0e0}.note-item{display:flex;padding:5px 10px;border-bottom:1px solid #444;align-items:center}.note-item:last-child{border-bottom:none}.note-name{font-weight:700;flex:1;text-align:center;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.note-freq{color:#aaa;flex:1;text-align:center;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.note-time{color:#aaa;flex:1;text-align:center;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.note-duration{color:#aaa;flex:1;text-align:center;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.panel-buttons{display:grid;grid-template-columns:1fr 1fr;gap:10px}.panel-button{background-color:#444;border:1px solid #666;border-radius:5px;color:#e0e0e0;padding:8px 15px;cursor:pointer;transition:background-color .2s;flex:1;min-width:120px;display:flex;align-items:center;justify-content:center}.panel-button:hover{background-color:#555}.wave-selector{display:inline-flex;margin:0 5px;vertical-align:middle}.wave-option{width:60px;height:30px;background-color:#333;border:1px solid #555;margin:0 2px;cursor:pointer;position:relative;transition:all .2s}.wave-option:hover{background-color:#444}.wave-option.selected{background-color:#555;border-color:#777}.wave-option svg{width:100%;height:100%}.wave-option path{stroke:#e0e0e0;stroke-width:1.5;fill:none}.piano-svg{display:block}.hexagon{cursor:pointer;stroke:#000;stroke-width:1px;transition:fill 50ms ease-in-out}.note-text{fill:#fff;stroke:#000;stroke-width:1px;text-anchor:middle;font-size:200%;font-weight:700;pointer-events:none}.note-key{fill:#000;stroke:#000;stroke-width:1px;text-anchor:middle;font-size:120%;font-weight:400;pointer-events:none}.hexagon[data-note-name^="C"]:not([data-note-name*="#"]){fill:#e74c3c}.hexagon[data-note-name^="D"]:not([data-note-name*="#"]){fill:#f1c40f}.hexagon[data-note-name^="E"]{fill:#2ecc71}.hexagon[data-note-name^="F"]:not([data-note-name*="#"]){fill:#3498db}.hexagon[data-note-name^="G"]:not([data-note-name*="#"]){fill:#9b59b6}.hexagon[data-note-name^="A"]:not([data-note-name*="#"]){fill:#e67e22}.hexagon[data-note-name^="B"]{fill:#1abc9c}.hexagon[data-note-name*="C#"]{fill:#64411e}.hexagon[data-note-name*="D#"]{fill:#505f2d}.hexagon[data-note-name*="F#"]{fill:#413c5f}.hexagon[data-note-name*="G#"]{fill:#5f414b}.hexagon[data-note-name*="A#"]{fill:#41554b}.hexagon[data-note-name^="C"]:not([data-note-name*="#"]).active{fill:#ff7878}.hexagon[data-note-name^="D"]:not([data-note-name*="#"]).active{fill:#fadc78}.hexagon[data-note-name^="E"].active{fill:#50e66e}.hexagon[data-note-name^="F"]:not([data-note-name*="#"]).active{fill:#64d2fa}.hexagon[data-note-name^="G"]:not([data-note-name*="#"]).active{fill:#b982d2}.hexagon[data-note-name^="A"]:not([data-note-name*="#"]).active{fill:#faa032}.hexagon[data-note-name^="B"].active{fill:#50d2be}.hexagon[data-note-name*="C#"].active{fill:#8c5f32}.hexagon[data-note-name*="D#"].active{fill:#6e7d41}.hexagon[data-note-name*="F#"].active{fill:#555073}.hexagon[data-note-name*="G#"].active{fill:#73555f}.hexagon[data-note-name*="A#"].active{fill:#55695f}@keyframes pulse{0%{box-shadow:0 0 0 0 rgba(255,65,54,.7)}70%{box-shadow:0 0 0 10px rgba(255,65,54,0)}100%{box-shadow:0 0 0 0 rgba(255,65,54,0)}}.progress-container{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:300px;background-color:#333;border:1px solid #555;border-radius:5px;padding:15px;z-index:2000;display:none;box-shadow:0 5px 25px rgba(0,0,0,.8)}.progress-container.active{display:block}.progress-bar{width:100%;height:10px;background-color:#222;border-radius:5px;margin-top:10px;overflow:hidden}.progress-fill{height:100%;background-color:#4caf50;background-color:#9bbc0f!important;width:0%;transition:width .3s}.progress-text{text-align:center;margin-bottom:5px}.gameboy-theme{background-color:#9bbc0f!important}.guitar-theme{background-color:#8b4513!important}.snes-theme{background-color:#5d4e37!important}.drums-theme{background-color:#3a3a3a!important}.bell-theme{background-color:#d4af37!important}.flute-theme{background-color:sienna!important}.violin-theme{background-color:#5d4037!important}.ukulele-theme{background-color:#deb887!important}.tuba-theme{background-color:#4e342e!important}.custom-theme{background-color:#2e8b57!important}</style><script type="text/javascript">var DEBUG=!1;document.addEventListener("DOMContentLoaded",function(){function F(){le(),se(),D(),e(),window.addEventListener("resize",e),window.addEventListener("orientationchange",function(){setTimeout(e,100)})}function e(){if(C&&Re){var e=C.querySelector(".piano-svg");if(e){var t=Re.clientWidth,n=Re.clientHeight,a=window.innerHeight>window.innerWidth,o=N,o=(N=a?rt:ct,JSON.stringify(o)),i=JSON.stringify(N);if(o!==i){for(;C.firstChild;)C.removeChild(C.firstChild);I={},L={},le(),e=C.querySelector(".piano-svg")}var l,r,c,u,o=e.getAttribute("viewBox").split(" "),i=parseFloat(o[2]),o=parseFloat(o[3]);0!==t&&0!==n&&(l=1,a=a?(c=n/i,u=t/o,l=Math.min(c,u),r=o*l,i*l):(c=t/i,u=n/o,l=Math.min(c,u),r=i*l,o*l),C.style.transform="none",C.style.width=r+"px",C.style.height=a+"px",e.style.width="100%",e.style.height="100%",C.style.transformOrigin="center center")}}}function D(){for(var e=[{id:"default",name:"Default",InstClass:Ye},{id:"gameboy",name:"Gameboy",InstClass:Ze},{id:"guitar",name:"Guitar",InstClass:$e},{id:"snes",name:"SNES",InstClass:_e},{id:"drums",name:"Drums & Percussion",InstClass:et},{id:"bell",name:"Bell",InstClass:tt},{id:"flute",name:"Flute",InstClass:nt},{id:"violin",name:"Violin",InstClass:at},{id:"ukulele",name:"Ukulele",InstClass:ot},{id:"tuba",name:"Tuba",InstClass:it},{id:"custom",name:"Custom Sample",InstClass:lt}],t=0;t<e.length;t++){var n=e[t],a=document.createElement("div");a.className="instrument-option",a.setAttribute("data-instrument",n.id),a.innerHTML=n.name,"default"===n.id&&a.classList.add("selected"),a.addEventListener("click",function(){O(this.getAttribute("data-instrument"))}),u.appendChild(a)}A=Ye.create()}function O(e){for(var t={default:Ye,gameboy:Ze,guitar:$e,snes:_e,drums:et,bell:tt,flute:nt,violin:at,ukulele:ot,tuba:it,custom:lt},n=(A&&A.cleanup(),A=(t[e].InstClass||t[e]).create(),A.init(),u.querySelectorAll(".instrument-option")),a=0;a<n.length;a++)n[a].classList.remove("selected"),n[a].getAttribute("data-instrument")===e&&n[a].classList.add("selected");u.classList.remove("active")}function z(){document.querySelector(".wave-selector").style.display="none";var e=document.querySelector(".control-bar"),t=document.createElement("div"),n=(t.id="gameboy-controls",t.style.display="inline-flex",t.style.marginLeft="10px",document.createElement("div")),a=(n.className="control-group",n.style.marginRight="10px",document.createElement("label")),o=(a.textContent="Wave",a.style.marginBottom="5px",a.style.fontSize="0.8em",document.createElement("select")),i=(o.id="gameboy-wave",o.style.width="120px",document.createElement("option")),i=(i.value="square",i.textContent="Pulse (50%)",o.appendChild(i),document.createElement("option")),i=(i.value="sawtooth",i.textContent="Pulse (25%)",o.appendChild(i),document.createElement("option")),i=(i.value="triangle",i.textContent="Triangle",o.appendChild(i),n.appendChild(a),n.appendChild(o),document.createElement("div")),a=(i.className="control-group",i.style.marginRight="10px",document.createElement("label")),o=(a.textContent="Noise",a.style.marginBottom="5px",a.style.fontSize="0.8em",document.createElement("select")),l=(o.id="gameboy-noise",o.style.width="120px",document.createElement("option")),l=(l.value="white",l.textContent="White Noise",o.appendChild(l),document.createElement("option")),l=(l.value="pink",l.textContent="Pink Noise",o.appendChild(l),i.appendChild(a),i.appendChild(o),document.createElement("div")),a=(l.className="control-group",l.style.marginRight="10px",document.createElement("label")),o=(a.textContent="Attack",a.id="gameboy-attack-label",a.style.marginBottom="5px",a.style.fontSize="0.8em",document.createElement("input")),a=(o.type="range",o.id="gameboy-attack",o.min="0",o.max="0.5",o.step="0.01",o.value="0",o.style.width="100px",o.addEventListener("input",function(){document.getElementById("gameboy-attack-label").textContent="Attack"}),l.appendChild(a),l.appendChild(o),document.createElement("div")),o=(a.className="control-group",document.createElement("label")),r=(o.textContent="Release",o.id="gameboy-release-label",o.style.marginBottom="5px",o.style.fontSize="0.8em",document.createElement("input"));r.type="range",r.id="gameboy-release",r.min="0",r.max="1",r.step="0.01",r.value="0.3",r.style.width="100px",r.addEventListener("input",function(){document.getElementById("gameboy-release-label").textContent="Release"}),a.appendChild(o),a.appendChild(r),t.appendChild(n),t.appendChild(i),t.appendChild(l),t.appendChild(a),e.appendChild(t)}function M(){var e=document.getElementById("gameboy-controls");e&&e.parentNode.removeChild(e),document.querySelector(".wave-selector").style.display="inline-flex"}function U(){document.querySelector(".wave-selector").style.display="none";var e=document.querySelector(".control-bar"),t=document.createElement("div"),n=(t.id="guitar-controls",t.style.display="inline-flex",t.style.marginLeft="10px",document.createElement("div")),a=(n.className="control-group",n.style.marginRight="10px",document.createElement("label")),o=(a.textContent="Type",a.style.marginBottom="5px",a.style.fontSize="0.8em",document.createElement("select")),i=(o.id="guitar-type",o.style.width="120px",document.createElement("option")),i=(i.value="acoustic",i.textContent="Acoustic",o.appendChild(i),document.createElement("option")),i=(i.value="electric",i.textContent="Electric",o.appendChild(i),document.createElement("option")),i=(i.value="bass",i.textContent="Bass",o.appendChild(i),n.appendChild(a),n.appendChild(o),document.createElement("div")),a=(i.className="control-group",i.style.marginRight="10px",document.createElement("label")),o=(a.textContent="Damping",a.id="guitar-damping-label",a.style.marginBottom="5px",a.style.fontSize="0.8em",document.createElement("input")),a=(o.type="range",o.id="guitar-damping",o.min="0.9",o.max="0.999",o.step="0.001",o.value="0.995",o.style.width="100px",o.addEventListener("input",function(){document.getElementById("guitar-damping-label").textContent="Damping"}),i.appendChild(a),i.appendChild(o),document.createElement("div")),o=(a.className="control-group",document.createElement("label")),l=(o.textContent="Body",o.id="guitar-body-label",o.style.marginBottom="5px",o.style.fontSize="0.8em",document.createElement("input"));l.type="range",l.id="guitar-body",l.min="0",l.max="1",l.step="0.01",l.value="0.3",l.style.width="100px",l.addEventListener("input",function(){document.getElementById("guitar-body-label").textContent="Body"}),a.appendChild(o),a.appendChild(l),t.appendChild(n),t.appendChild(i),t.appendChild(a),e.appendChild(t)}function Q(){var e=document.getElementById("guitar-controls");e&&e.parentNode.removeChild(e),document.querySelector(".wave-selector").style.display="inline-flex"}function P(){document.querySelector(".wave-selector").style.display="none";var e=document.querySelector(".control-bar"),t=document.createElement("div"),n=(t.id="snes-controls",t.style.display="inline-flex",t.style.marginLeft="10px",document.createElement("div")),a=(n.className="control-group",n.style.marginRight="10px",document.createElement("label")),o=(a.textContent="Instrument",a.style.marginBottom="5px",a.style.fontSize="0.8em",document.createElement("select")),i=(o.id="snes-instrument",o.style.width="120px",document.createElement("option")),i=(i.value="piano",i.textContent="Piano",o.appendChild(i),document.createElement("option")),i=(i.value="strings",i.textContent="Strings",o.appendChild(i),document.createElement("option")),i=(i.value="brass",i.textContent="Brass",o.appendChild(i),document.createElement("option")),i=(i.value="woodwind",i.textContent="Woodwind",o.appendChild(i),document.createElement("option")),i=(i.value="percussion",i.textContent="Percussion",o.appendChild(i),n.appendChild(a),n.appendChild(o),document.createElement("div")),a=(i.className="control-group",i.style.marginRight="10px",document.createElement("label")),o=(a.textContent="Reverb",a.id="snes-reverb-label",a.style.marginBottom="5px",a.style.fontSize="0.8em",document.createElement("input")),a=(o.type="range",o.id="snes-reverb",o.min="0",o.max="1",o.step="0.05",o.value="0.3",o.style.width="100px",o.addEventListener("input",function(){document.getElementById("snes-reverb-label").textContent="Reverb"}),i.appendChild(a),i.appendChild(o),document.createElement("div")),o=(a.className="control-group",a.style.marginRight="10px",document.createElement("label")),l=(o.textContent="Attack",o.id="snes-attack-label",o.style.marginBottom="5px",o.style.fontSize="0.8em",document.createElement("input")),o=(l.type="range",l.id="snes-attack",l.min="0",l.max="0.5",l.step="0.01",l.value="0.05",l.style.width="100px",l.addEventListener("input",function(){document.getElementById("snes-attack-label").textContent="Attack"}),a.appendChild(o),a.appendChild(l),document.createElement("div")),l=(o.className="control-group",document.createElement("label")),r=(l.textContent="Release",l.id="snes-release-label",l.style.marginBottom="5px",l.style.fontSize="0.8em",document.createElement("input"));r.type="range",r.id="snes-release",r.min="0",r.max="2",r.step="0.05",r.value="0.5",r.style.width="100px",r.addEventListener("input",function(){document.getElementById("snes-release-label").textContent="Release"}),o.appendChild(l),o.appendChild(r),t.appendChild(n),t.appendChild(i),t.appendChild(a),t.appendChild(o),e.appendChild(t)}function j(){var e=document.getElementById("snes-controls");e&&e.parentNode.removeChild(e),document.querySelector(".wave-selector").style.display="inline-flex"}function H(){document.querySelector(".wave-selector").style.display="none";var e=document.querySelector(".control-bar"),t=document.createElement("div"),n=(t.id="drums-controls",t.style.display="inline-flex",t.style.marginLeft="10px",document.createElement("div")),a=(n.className="control-group",n.style.marginRight="10px",document.createElement("label")),o=(a.textContent="Drum Type",a.style.marginBottom="5px",a.style.fontSize="0.8em",document.createElement("select")),i=(o.id="drums-type",o.style.width="120px",document.createElement("option")),i=(i.value="kick",i.textContent="Kick",o.appendChild(i),document.createElement("option")),i=(i.value="snare",i.textContent="Snare",o.appendChild(i),document.createElement("option")),i=(i.value="tom",i.textContent="Tom",o.appendChild(i),document.createElement("option")),i=(i.value="hihat",i.textContent="Hi-Hat",o.appendChild(i),document.createElement("option")),i=(i.value="cymbal",i.textContent="Cymbal",o.appendChild(i),n.appendChild(a),n.appendChild(o),document.createElement("div")),a=(i.className="control-group",i.style.marginRight="10px",document.createElement("label")),o=(a.textContent="Pitch",a.id="drums-pitch-label",a.style.marginBottom="5px",a.style.fontSize="0.8em",document.createElement("input")),a=(o.type="range",o.id="drums-pitch",o.min="0.5",o.max="2",o.step="0.1",o.value="1",o.style.width="100px",o.addEventListener("input",function(){document.getElementById("drums-pitch-label").textContent="Pitch"}),i.appendChild(a),i.appendChild(o),document.createElement("div")),o=(a.className="control-group",document.createElement("label")),l=(o.textContent="Decay",o.id="drums-decay-label",o.style.marginBottom="5px",o.style.fontSize="0.8em",document.createElement("input"));l.type="range",l.id="drums-decay",l.min="0.1",l.max="2",l.step="0.1",l.value="0.5",l.style.width="100px",l.addEventListener("input",function(){document.getElementById("drums-decay-label").textContent="Decay"}),a.appendChild(o),a.appendChild(l),t.appendChild(n),t.appendChild(i),t.appendChild(a),e.appendChild(t)}function W(){var e=document.getElementById("drums-controls");e&&e.parentNode.removeChild(e),document.querySelector(".wave-selector").style.display="inline-flex"}function J(){document.querySelector(".wave-selector").style.display="none";var e=document.querySelector(".control-bar"),t=document.createElement("div"),n=(t.id="bell-controls",t.style.display="inline-flex",t.style.marginLeft="10px",document.createElement("div")),a=(n.className="control-group",n.style.marginRight="10px",document.createElement("label")),o=(a.textContent="Decay",a.id="bell-decay-label",a.style.marginBottom="5px",a.style.fontSize="0.8em",document.createElement("input")),a=(o.type="range",o.id="bell-decay",o.min="0.5",o.max="5.0",o.step="0.1",o.value="2.5",o.style.width="100px",n.appendChild(a),n.appendChild(o),document.createElement("div")),o=(a.className="control-group",document.createElement("label")),i=(o.textContent="Bright",o.id="bell-brightness-label",o.style.marginBottom="5px",o.style.fontSize="0.8em",document.createElement("input"));i.type="range",i.id="bell-brightness",i.min="0",i.max="1",i.step="0.1",i.value="0.5",i.style.width="100px",a.appendChild(o),a.appendChild(i),t.appendChild(n),t.appendChild(a),e.appendChild(t)}function K(){var e=document.getElementById("bell-controls");e&&e.parentNode.removeChild(e),document.querySelector(".wave-selector").style.display="inline-flex"}function X(){document.querySelector(".wave-selector").style.display="none";var e=document.querySelector(".control-bar"),t=document.createElement("div"),n=(t.id="flute-controls",t.style.display="inline-flex",t.style.marginLeft="10px",document.createElement("div")),a=(n.className="control-group",n.style.marginRight="10px",document.createElement("label")),o=(a.textContent="Breath",a.id="flute-breath-label",a.style.marginBottom="5px",a.style.fontSize="0.8em",document.createElement("input")),a=(o.type="range",o.id="flute-breath",o.min="0",o.max="0.5",o.step="0.01",o.value="0.1",o.style.width="100px",o.addEventListener("input",function(){document.getElementById("flute-breath-label").textContent="Breath"}),n.appendChild(a),n.appendChild(o),document.createElement("div")),o=(a.className="control-group",document.createElement("label")),i=(o.textContent="Vibrato",o.id="flute-vibrato-label",o.style.marginBottom="5px",o.style.fontSize="0.8em",document.createElement("input"));i.type="range",i.id="flute-vibrato",i.min="0",i.max="10",i.step="0.5",i.value="5",i.style.width="100px",i.addEventListener("input",function(){document.getElementById("flute-vibrato-label").textContent="Vibrato"}),a.appendChild(o),a.appendChild(i),t.appendChild(n),t.appendChild(a),e.appendChild(t)}function Y(){var e=document.getElementById("flute-controls");e&&e.parentNode.removeChild(e),document.querySelector(".wave-selector").style.display="inline-flex"}function Z(){document.querySelector(".wave-selector").style.display="none";var e=document.querySelector(".control-bar"),t=document.createElement("div"),n=(t.id="violin-controls",t.style.display="inline-flex",t.style.marginLeft="10px",document.createElement("div")),a=(n.className="control-group",n.style.marginRight="10px",document.createElement("label")),o=(a.textContent="Attack",a.id="violin-attack-label",a.style.marginBottom="5px",a.style.fontSize="0.8em",document.createElement("input")),a=(o.type="range",o.id="violin-attack",o.min="0.05",o.max="0.5",o.step="0.01",o.value="0.2",o.style.width="100px",o.addEventListener("input",function(){document.getElementById("violin-attack-label").textContent="Attack"}),n.appendChild(a),n.appendChild(o),document.createElement("div")),o=(a.className="control-group",a.style.marginRight="10px",document.createElement("label")),i=(o.textContent="Vib Rate",o.id="violin-vibrato-label",o.style.marginBottom="5px",o.style.fontSize="0.8em",document.createElement("input")),o=(i.type="range",i.id="violin-vibrato",i.min="0",i.max="12",i.step="0.5",i.value="6",i.style.width="100px",i.addEventListener("input",function(){document.getElementById("violin-vibrato-label").textContent="Vib Rate"}),a.appendChild(o),a.appendChild(i),document.createElement("div")),i=(o.className="control-group",document.createElement("label")),l=(i.textContent="Filter",i.id="violin-filter-label",i.style.marginBottom="5px",i.style.fontSize="0.8em",document.createElement("input"));l.type="range",l.id="violin-filter",l.min="500",l.max="5000",l.step="100",l.value="2500",l.style.width="100px",l.addEventListener("input",function(){document.getElementById("violin-filter-label").textContent="Filter"}),o.appendChild(i),o.appendChild(l),t.appendChild(n),t.appendChild(a),t.appendChild(o),e.appendChild(t)}function $(){var e=document.getElementById("violin-controls");e&&e.parentNode.removeChild(e),document.querySelector(".wave-selector").style.display="inline-flex"}function _(){document.querySelector(".wave-selector").style.display="none";var e=document.querySelector(".control-bar"),t=document.createElement("div"),n=(t.id="ukulele-controls",t.style.display="inline-flex",t.style.marginLeft="10px",document.createElement("div")),a=(n.className="control-group",n.style.marginRight="10px",document.createElement("label")),o=(a.textContent="Decay",a.id="ukulele-decay-label",a.style.marginBottom="5px",a.style.fontSize="0.8em",document.createElement("input")),a=(o.type="range",o.id="ukulele-decay",o.min="0.1",o.max="1.5",o.step="0.1",o.value="0.8",o.style.width="100px",o.addEventListener("input",function(){document.getElementById("ukulele-decay-label").textContent="Decay"}),n.appendChild(a),n.appendChild(o),document.createElement("div")),o=(a.className="control-group",document.createElement("label")),i=(o.textContent="Nylon",o.id="ukulele-nylon-label",o.style.marginBottom="5px",o.style.fontSize="0.8em",document.createElement("input"));i.type="range",i.id="ukulele-nylon",i.min="2",i.max="10",i.step="0.5",i.value="4",i.style.width="100px",i.addEventListener("input",function(){document.getElementById("ukulele-nylon-label").textContent="Nylon"}),a.appendChild(o),a.appendChild(i),t.appendChild(n),t.appendChild(a),e.appendChild(t)}function ee(){var e=document.getElementById("ukulele-controls");e&&e.parentNode.removeChild(e),document.querySelector(".wave-selector").style.display="inline-flex"}function te(){document.querySelector(".wave-selector").style.display="none";var e=document.querySelector(".control-bar"),t=document.createElement("div"),n=(t.id="tuba-controls",t.style.display="inline-flex",t.style.marginLeft="10px",document.createElement("div")),a=(n.className="control-group",n.style.marginRight="10px",document.createElement("label")),o=(a.textContent="Attack",a.id="tuba-attack-label",a.style.marginBottom="5px",a.style.fontSize="0.8em",document.createElement("input")),a=(o.type="range",o.id="tuba-attack",o.min="0.05",o.max="0.5",o.step="0.01",o.value="0.2",o.style.width="100px",o.addEventListener("input",function(){document.getElementById("tuba-attack-label").textContent="Attack"}),n.appendChild(a),n.appendChild(o),document.createElement("div")),o=(a.className="control-group",a.style.marginRight="10px",document.createElement("label")),i=(o.textContent="Release",o.id="tuba-release-label",o.style.marginBottom="5px",o.style.fontSize="0.8em",document.createElement("input")),o=(i.type="range",i.id="tuba-release",i.min="0.1",i.max="1.0",i.step="0.05",i.value="0.4",i.style.width="100px",i.addEventListener("input",function(){document.getElementById("tuba-release-label").textContent="Release"}),a.appendChild(o),a.appendChild(i),document.createElement("div")),i=(o.className="control-group",o.style.marginRight="10px",document.createElement("label")),l=(i.textContent="Bright",i.id="tuba-brilliance-label",i.style.marginBottom="5px",i.style.fontSize="0.8em",document.createElement("input")),i=(l.type="range",l.id="tuba-brilliance",l.min="1",l.max="8",l.step="0.1",l.value="2.5",l.style.width="100px",l.addEventListener("input",function(){document.getElementById("tuba-brilliance-label").textContent="Bright"}),o.appendChild(i),o.appendChild(l),document.createElement("div")),l=(i.className="control-group",document.createElement("label")),r=(l.textContent="Vibrato",l.id="tuba-vibrato-label",l.style.marginBottom="5px",l.style.fontSize="0.8em",document.createElement("input"));r.type="range",r.id="tuba-vibrato",r.min="0",r.max="10",r.step="0.5",r.value="4",r.style.width="100px",r.addEventListener("input",function(){document.getElementById("tuba-vibrato-label").textContent="Vibrato"}),i.appendChild(l),i.appendChild(r),t.appendChild(n),t.appendChild(a),t.appendChild(o),t.appendChild(i),e.appendChild(t)}function ne(){var e=document.getElementById("tuba-controls");e&&e.parentNode.removeChild(e),document.querySelector(".wave-selector").style.display="inline-flex"}function ae(){document.querySelector(".wave-selector").style.display="none";var e=document.querySelector(".control-bar"),t=document.createElement("div"),n=(t.id="custom-controls",t.style.display="inline-flex",t.style.marginLeft="10px",t.style.alignItems="center",document.createElement("span")),a=(n.id="custom-status",n.textContent="No Sample",n.style.fontSize="0.8em",n.style.marginRight="10px",n.style.color="#aaa",document.createElement("button")),o=(a.textContent="Load Audio",a.style.fontSize="0.8em",a.style.padding="5px 10px",a.style.cursor="pointer",document.createElement("input"));o.type="file",o.id="custom-sample-file",o.accept="audio/*",o.style.display="none",a.addEventListener("click",function(){if(!G)try{var e;"function"==typeof i?i():(e=window.AudioContext||window.webkitAudioContext,G=new e,V||(V=G.createGain(),V.connect(G.destination)))}catch(e){return void console.error("Could not initialize AudioContext:",e)}o.click()}),o.addEventListener("change",function(e){var t,e=e.target.files[0];e&&(n.textContent="Loading...",n.style.color="yellow",t=new FileReader,t.onload=function(e){G.decodeAudioData(e.target.result,function(e){window.customSampleBuffer=e,window.customSampleBaseFreq=261.626,n.textContent="Sample Loaded",n.style.color="#4CAF50"},function(e){console.error("Error decoding audio data",e),n.textContent="Error Decoding",n.style.color="red"})},t.readAsArrayBuffer(e))}),t.appendChild(n),t.appendChild(a),t.appendChild(o),e.appendChild(t)}function oe(){var e=document.getElementById("custom-controls");e&&e.parentNode.removeChild(e),document.querySelector(".wave-selector").style.display="inline-flex",window.customSampleBuffer=null,window.customSampleBaseFreq=null}function i(){if(We)if(Je)DEBUG&&console.log("Audio context already initialized");else try{G=G||new We,ie(),"suspended"===G.state&&G.resume().then(function(){DEBUG&&(console.log("Audio context resumed successfully"),console.log("Audio context state after resume:",G.state))}).catch(function(e){console.error("Error resuming audio context:",e)})}catch(e){console.error("Error initializing audio context:",e),p=!1}else console.error("Web Audio API is not supported in this browser"),p=!1}function ie(){V=G.createGain(),V.gain.value=S.value;var e=G.createDynamicsCompressor();e.threshold.value=-12,e.knee.value=0,e.ratio.value=20,e.attack.value=.001,e.release.value=.1,V.connect(e),e.connect(G.destination),Je=!0,DEBUG&&(console.log("Audio context initialized successfully"),console.log("Audio context state:",G.state)),G.addEventListener("statechange",function(){DEBUG&&console.log("Audio context state changed to:",G.state),"suspended"===G.state&&G.resume().then(function(){DEBUG&&console.log("Audio context resumed after state change")}).catch(function(e){console.error("Error resuming audio context after state change:",e)})})}function le(){function e(e,t,n){for(var a=[],o=0;o<6;o++){var i=Math.PI/3*o-Math.PI/2,l=e+n*Math.cos(i),i=t+n*Math.sin(i);a.push(l+","+i)}return a.join(" ")}for(var t=document.createElementNS("http://www.w3.org/2000/svg","svg"),n=(t.setAttribute("class","piano-svg"),50),a=Math.sqrt(3)*n,o=1.75*n,i=.85*a,l=1/0,r=-1/0,c=1/0,u=-1/0,s=0;s<N.length;s++)for(var d=N[s],m=s%2==1?o/2:0,p=s*i,y=0;y<d.length;y++){var f=d[y],g=m+n+y*o,v=p+n,h=(g-n<l&&(l=g-n),r<g+n&&(r=g+n),v-n<c&&(c=v-n),u<v+n&&(u=v+n),document.createElementNS("http://www.w3.org/2000/svg","g")),E=(h.setAttribute("class","hexagon-group"),document.createElementNS("http://www.w3.org/2000/svg","polygon")),b=(E.setAttribute("class","hexagon"),E.setAttribute("id",f.note),E.setAttribute("points",e(g,v,n)),E.setAttribute("data-key",f.key),E.setAttribute("data-note",f.note),E.setAttribute("data-freq",f.freq),E.setAttribute("data-note-name",f.note.replace(/[0-9]/,"")),document.createElementNS("http://www.w3.org/2000/svg","text")),x=(b.setAttribute("class","note-text"),b.setAttribute("x",g),b.setAttribute("y",v),b.textContent=f.note,document.createElementNS("http://www.w3.org/2000/svg","text"));x.setAttribute("class","note-key"),x.setAttribute("x",g),x.setAttribute("y",v+20),x.textContent="Shift"===f.key?"â‡§":f.key,h.appendChild(E),h.appendChild(b),h.appendChild(x),t.appendChild(h),I[f.key]=f,L[f.note]=L[f.note]||[],L[f.note].push(E)}var a=r-l,q=u-c,T=0,a=a+T,q=q+T;t.setAttribute("viewBox",l-T/2+" "+(c-T/2)+" "+a+" "+q),C.appendChild(t)}function re(e,t){p?(G||(DEBUG&&console.log("Creating new AudioContext..."),G=new(window.AudioContext||window.webkitAudioContext)),"suspended"===G.state?(DEBUG&&console.log("AudioContext is suspended. Resuming..."),G.resume().then(function(){DEBUG&&console.log("AudioContext resumed. Playing note:",e),ce(e,t)}).catch(function(e){console.error("Error resuming audio context:",e)})):ce(e,t)):console.warn("Audio is not supported in this browser")}function ce(e,t){V||(DEBUG&&console.log("Creating mainGainNode..."),V=G.createGain(),V.gain.value=S.value,V.connect(G.destination)),DEBUG&&console.log("Audio context is running. Playing note:",e),R[e]&&l(e),A&&A.playNote(e,t)}function l(e){p&&G&&(R[e]?A&&A.stopNote(e):DEBUG&&console.log("Note is not playing:",e))}function ue(e){var t=L[e];if(t)for(var n=0;n<t.length;n++)t[n].classList.add("active")}function r(e){var t=L[e];if(t)for(var n=0;n<t.length;n++)t[n].classList.remove("active")}function o(e,t){var n,a;e&&(n=e.note,a=e.freq,re(n,a),ue(n),void 0!==t&&(E[t]=e),y)&&(t=performance.now(),null===b&&(b=t),h[n]={freq:a,startTime:t})}function c(e,t){var n;e&&(e=e.note,l(e),r(e),void 0!==t&&delete E[t],y)&&h[e]&&(t=h[e],n=performance.now(),n=n-t.startTime,20<n&&g.push({note:e,freq:t.freq,time:t.startTime-b,duration:n}),delete h[e])}function se(){C.addEventListener("mousedown",function(e){var t=e.target;t.classList.contains("hexagon")&&(e.preventDefault(),x=!0,e={note:t.getAttribute("data-note"),freq:parseFloat(t.getAttribute("data-freq"))},q=e,o(e))}),document.addEventListener("mousemove",function(e){x&&(e=document.elementFromPoint(e.clientX,e.clientY),e)&&e.classList.contains("hexagon")&&(e={note:e.getAttribute("data-note"),freq:parseFloat(e.getAttribute("data-freq"))},q&&q.note===e.note||(q&&c(q),o(e),q=e))}),document.addEventListener("mouseup",function(e){if(x)for(var t in x=!1,q&&(c(q),q=null),R)l(t),r(t)}),C.addEventListener("touchstart",function(e){var t=e.target;t.classList.contains("hexagon")&&(e.preventDefault(),x=!0,e=e.touches[0],t={note:t.getAttribute("data-note"),freq:parseFloat(t.getAttribute("data-freq"))},o(t,e.identifier))}),document.addEventListener("touchmove",function(e){var t,n;x&&(e=e.touches[0],t=document.elementFromPoint(e.clientX,e.clientY),t)&&t.classList.contains("hexagon")&&(t={note:t.getAttribute("data-note"),freq:parseFloat(t.getAttribute("data-freq"))},n=E[e.identifier],n&&n.note===t.note||(n&&c(n,e.identifier),o(t,e.identifier)))}),document.addEventListener("touchend",function(e){if(x){x=!1;for(var t,n=0;n<e.changedTouches.length;n++){var a=e.changedTouches[n],o=E[a.identifier];o&&c(o,a.identifier)}for(t in R)l(t),r(t)}}),window.addEventListener("keydown",function(e){var t;e.repeat||e.metaKey||e.ctrlKey||(t=e.key,t=I[t],t&&(e.preventDefault(),o(t)))}),window.addEventListener("keyup",function(e){var t=e.key,t=I[t];t&&(e.preventDefault(),c(t))}),Ne.addEventListener("click",Te),ze.addEventListener("click",fe),n.addEventListener("mousedown",de),n.addEventListener("mouseup",me),n.addEventListener("mouseleave",pe),n.addEventListener("touchstart",de),n.addEventListener("touchend",me),n.addEventListener("touchcancel",pe),Fe.addEventListener("click",function(e){e.stopPropagation(),u.classList.toggle("active")}),document.addEventListener("click",function(){u.classList.remove("active")});for(var t=document.querySelectorAll(".wave-option"),e=0;e<t.length;e++)t[e].addEventListener("click",function(){for(var e=0;e<t.length;e++)t[e].classList.remove("selected");this.classList.add("selected")});document.querySelector('.wave-option[data-wave-type="sine"]').classList.add("selected"),De.addEventListener("click",Be),S.addEventListener("input",function(e){V&&(V.gain.value=e.target.value)}),Me.addEventListener("click",function(){je.click()}),je.addEventListener("change",Ee),Ue.addEventListener("click",function(){He.click()}),He.addEventListener("change",be)}function de(e){e.preventDefault(),w=setTimeout(function(){ye(),Xe=!0},Ke)}function me(e){w&&(clearTimeout(w),w=null),Xe||Ce(),setTimeout(function(){Xe=!1},100)}function pe(e){w&&(clearTimeout(w),w=null)}function ye(){Oe.classList.add("active"),w=null,ge()}function fe(){Oe.classList.remove("active")}function ge(){if(m.innerHTML="",0===g.length)e=document.createElement("div"),e.textContent="No melody recorded yet. Record a melody to see it here.",e.style.textAlign="center",e.style.padding="20px",m.appendChild(e);else{var e=document.createElement("div"),t=(e.className="note-list-header",document.createElement("div")),n=(t.className="note-name",t.textContent="Note",document.createElement("div")),a=(n.className="note-freq",n.textContent="Freq. (Hz)",document.createElement("div")),o=(a.className="note-time",a.textContent="Time (ms)",document.createElement("div"));o.className="note-duration",o.textContent="Duration (ms)",e.appendChild(t),e.appendChild(n),e.appendChild(a),e.appendChild(o),m.appendChild(e);for(var i=0;i<g.length;i++){var l=g[i],r=document.createElement("div"),c=(r.className="note-item",document.createElement("div")),u=(c.className="note-name",c.textContent=l.note,document.createElement("div")),s=(u.className="note-freq",u.textContent=l.freq.toFixed(3),document.createElement("div")),d=(s.className="note-time",s.textContent=l.time.toFixed(0),document.createElement("div"));d.className="note-duration",d.textContent=l.duration.toFixed(0),r.appendChild(c),r.appendChild(u),r.appendChild(s),r.appendChild(d),m.appendChild(r)}}}function ve(){var e,t,n;0===g.length?alert("No melody to export. Record a melody first."):(e={name:"Hexano Melody",date:(new Date).toISOString(),notes:g},e=JSON.stringify(e,null,2),e="data:application/json;charset=utf-8,"+encodeURIComponent(e),t="hexano.json",n=document.createElement("a"),n.setAttribute("href",e),n.setAttribute("download",t),n.click())}function he(){0===g.length?alert("No melody to export. Record a melody first."):(s.classList.add("active"),d.textContent="Rendering audio file...",T.style.width="10%",Ge())}function Ee(e){var t,n=e.target.files[0];n&&(t=new FileReader,t.onload=function(e){try{var t=JSON.parse(e.target.result);if(!t.notes||!Array.isArray(t.notes))throw new Error("Invalid melody file format");g=t.notes,ge(),alert("Melody imported successfully!")}catch(e){alert("Error importing melody: "+e.message)}},t.readAsText(n),e.target.value="")}function be(e){var t,n=e.target.files[0];n&&(Je||i(),s.classList.add("active"),d.textContent="Loading audio file...",T.style.width="10%",t=new FileReader,t.onload=function(e){G.decodeAudioData(e.target.result).then(function(e){d.textContent="Analyzing frequencies...",T.style.width="30%";e.duration;xe(e).then(function(e){d.textContent="Processing melody...",T.style.width="70%",g=e,ge(),d.textContent="Complete!",T.style.width="100%",setTimeout(function(){s.classList.remove("active"),T.style.width="0%"},1e3)}).catch(function(e){console.error("Error analyzing audio:",e),d.textContent="Error: "+e.message,setTimeout(function(){s.classList.remove("active"),T.style.width="0%"},3e3)})}).catch(function(e){console.error("Error decoding audio data:",e),d.textContent="Error decoding audio: "+e.message,setTimeout(function(){s.classList.remove("active"),T.style.width="0%"},3e3)})},t.readAsArrayBuffer(n),e.target.value="")}function xe(q){return new Promise(function(n,t){try{var e=q.sampleRate,a=(q.getChannelData(0),new We),c=a.createBufferSource(),u=(c.buffer=q,a.createAnalyser()),s=(u.fftSize=4096,
u.smoothingTimeConstant=.7,u.minDecibels=-70,u.maxDecibels=-20,c.connect(u),[]),d={},m={},p={},y=!1,f=100,g=25,i=e/u.fftSize,v=3,o=u.frequencyBinCount,h=new Uint8Array(o);function E(e,t){for(var n,a=[],o=2;o<e.length-2;o++)e[o]<t||e[o]>e[o-1]&&e[o]>e[o+1]&&e[o]>e[o-2]&&e[o]>e[o+2]&&e[o]>e[o-3]&&e[o]>e[o+3]&&(n=o*i,50<=n)&&n<=5e3&&a.push({index:o,frequency:n,amplitude:e[o]});return a.sort(function(e,t){return t.amplitude-e.amplitude}),a.slice(0,6)}function b(){if(!y){u.getByteFrequencyData(h);for(var e,t,n=E(h,g),a=1e3*c.context.currentTime,o={},i=0;i<n.length;i++){var l=qe(n[i].frequency);l&&(o[l.note]=l)}for(e in o)d[e]?p[e]=v:(p[e]=(p[e]||0)+1,p[e]>=v&&(d[e]=o[e],m[e]=a));for(e in d)o[e]||(p[e]=(p[e]||v)-1,p[e]<=0&&(t=a-m[e],f<=t&&s.push({note:e,freq:d[e].freq,time:m[e],duration:t}),delete d[e],delete m[e],delete p[e]));var r=a/(1e3*q.duration)*100;T.style.width=Math.min(r,100)+"%",a<1e3*q.duration?requestAnimationFrame(b):x()}}function x(){if(!y){for(var e in y=!0,d){var t=1e3*q.duration-m[e];f<=t&&s.push({note:e,freq:d[e].freq,time:m[e],duration:t})}s.sort(function(e,t){return e.time-t.time}),c.stop(),a.close(),T.style.width="100%",n(s)}}c.start(),requestAnimationFrame(b),setTimeout(function(){y||x()},1e3*q.duration+1e3)}catch(e){t(e)}})}function qe(e){if(e<30||6e3<e)return null;for(var t=null,n=1/0,a=0;a<B.length;a++){var o=B[a],i=Math.abs(e-o.freq);i<n&&(n=i,t=o)}var l=1200*Math.log2(e/t.freq);return Math.abs(l)<50?t:null}function Te(){if(p)if(y=!y,y)f&&ke(),Ne.className="recording",g=[],h={},performance.now(),b=null;else{Ne.className="";var e,t,n=performance.now();for(e in h)h.hasOwnProperty(e)&&(t=h[e],g.push({note:e,freq:t.freq,time:t.startTime-b,duration:n-t.startTime}));h={},0<g.length&&Ge()}else alert("Audio recording is not supported in this browser")}function Ce(){p?f?ke():0<g.length&&we():alert("Audio playback is not supported in this browser")}function we(){y&&Te(),f=!0,Ie.style.display="none",Le.style.display="block",DEBUG&&(console.log("Recorded Melody:"),console.log(g)),G=G||new(window.AudioContext||window.webkitAudioContext),"suspended"===G.state?(DEBUG&&console.log("Suspending playback to resume audio context..."),G.resume().then(function(){DEBUG&&console.log("Audio context resumed. Starting playback..."),Ae()}).catch(function(e){console.error("Error resuming audio context:",e)})):Ae()}function Ae(){DEBUG&&console.log("Starting melody playback...");for(var e=0;e<g.length;e++){var t=g[e],n={note:t.note,freq:t.freq};((e,t,n)=>{var a=setTimeout(function(){o(e)},t),t=setTimeout(function(){c(e)},t+n);v.push(a,t)})(n,t.time,t.duration)}var a=0<g.length?Math.max.apply(Math,g.map(function(e){return e.time+e.duration})):0,a=setTimeout(ke,a+500);v.push(a)}function ke(){f=!1,Ie.style.display="block",Le.style.display="none";for(var e,t=0;t<v.length;t++)clearTimeout(v[t]);for(e in v=[],R)l(e),r(e)}function Be(){document.fullscreenElement?document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen():document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.webkitRequestFullscreen?document.documentElement.webkitRequestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.msRequestFullscreen&&document.documentElement.msRequestFullscreen()}function Ge(){if(0!==g.length&&p){var e=Math.max.apply(Math,g.map(function(e){return e.time+e.duration})),e=e/1e3+.5;try{var t=new OfflineAudioContext(2,Math.ceil(44100*e),44100),n=t.createGain(),a=(n.gain.value=.7,t.createDynamicsCompressor());a.threshold.value=-10,a.knee.value=0,a.ratio.value=20,a.attack.value=.001,a.release.value=.1,n.connect(a),a.connect(t.destination);for(var o=0;o<g.length;o++){var i=g[o],l=i.time/1e3,r=i.duration/1e3;r<=.01||A&&A.render(t,i,l,r,n)}d.textContent="Rendering audio file...",T.style.width="90%",t.startRendering().then(function(e){e=Se(e);Ve(e,"hexano.wav"),s.classList.remove("active"),T.style.width="0%"}).catch(function(e){console.error("Failed to render WAV:",e),alert("Sorry, there was an error creating the audio file."),s.classList.remove("active"),T.style.width="0%"})}catch(e){console.error("Error generating WAV:",e),alert("Sorry, there was an error creating the audio file."),s.classList.remove("active"),T.style.width="0%"}}else s.classList.remove("active"),T.style.width="0%"}function Ve(e,t){var e=URL.createObjectURL(e),n=document.createElement("a");n.style.display="none",n.href=e,n.download=t,document.body.appendChild(n),n.click(),URL.revokeObjectURL(e),n.parentNode.removeChild(n)}function Se(e){var t,n,a=e.numberOfChannels,o=e.length*a*2+44,i=new ArrayBuffer(o),l=new DataView(i),r=[],c=0,u=0,s=function(e){l.setUint16(u,e,!0),u+=2},d=function(e){l.setUint32(u,e,!0),u+=4};for(d(1179011410),d(o-8),d(1163280727),d(544501094),d(16),s(1),s(a),d(e.sampleRate),d(2*e.sampleRate*a),s(2*a),s(16),d(1635017060),d(o-u-4),t=0;t<e.numberOfChannels;t++)r.push(e.getChannelData(t));for(;u<o;){for(t=0;t<a;t++)n=Math.max(-1,Math.min(1,r[t][c])),n=n<0?32768*n:32767*n,l.setInt16(u,n,!0),u+=2;c++}return new Blob([i],{type:"audio/wav"})}var G,V,Re=document.querySelector(".hexboard-container"),C=document.querySelector(".hexboard"),Ne=document.getElementById("record-button"),n=document.getElementById("play-button"),Ie=document.getElementById("play-icon"),Le=document.getElementById("stop-icon"),Fe=document.getElementById("instrument-button"),u=document.getElementById("instrument-dropdown"),S=(document.getElementById("wave-type"),document.getElementById("volume-slider")),De=document.getElementById("fullscreen-button"),t=document.getElementById("fullscreen-enter-icon"),a=document.getElementById("fullscreen-exit-icon"),Oe=document.getElementById("overlay-panel"),ze=document.getElementById("panel-close-btn"),m=document.getElementById("panel-content"),Me=document.getElementById("import-json-btn"),Ue=document.getElementById("import-audio-btn"),Qe=document.getElementById("export-json-btn"),Pe=document.getElementById("export-audio-btn"),je=document.getElementById("file-input"),He=document.getElementById("audio-file-input"),s=document.getElementById("progress-container"),T=document.getElementById("progress-fill"),d=document.getElementById("progress-text"),Me=document.getElementById("import-json-btn"),je=(Me.addEventListener("click",function(){document.getElementById("file-input").click()}),Ue=document.getElementById("import-audio-btn"),Ue.addEventListener("click",function(){document.getElementById("audio-file-input").click()}),Qe=document.getElementById("export-json-btn"),Qe.addEventListener("click",ve),Pe=document.getElementById("export-audio-btn"),Pe.addEventListener("click",he),document.getElementById("file-input")),He=document.getElementById("audio-file-input"),s=document.getElementById("progress-container"),T=document.getElementById("progress-fill"),d=document.getElementById("progress-text"),We=window.AudioContext||window.webkitAudioContext,R={},p=!0,Je=!1,y=!1,f=!1,g=[{note:"C5",freq:523.251,time:0,duration:300},{note:"D5",freq:587.33,time:400,duration:300},{note:"E5",freq:659.255,time:800,duration:300},{note:"F5",freq:698.456,time:1200,duration:300},{note:"A5",freq:880,time:1600,duration:600},{note:"G5",freq:783.991,time:2200,duration:600},{note:"A5",freq:880,time:3200,duration:600},{note:"G5",freq:783.991,time:3800,duration:300},{note:"F5",freq:698.456,time:4100,duration:300},{note:"E5",freq:659.255,time:4400,duration:600},{note:"G5",freq:783.991,time:5e3,duration:600},{note:"D5",freq:587.33,time:5600,duration:600}],v=[],h={},E={},b=null,x=!1,q=null,w=null,Ke=500,Xe=!1,A=null,k={create:function(e){return{name:e,type:"Instrument",activeNodes:R}}},Ye={create:function(){var e=k.create("Default");return e.init=function(){},e.playNote=function(e,t){try{var n=G.currentTime;if(!V||V.context!==G){if(!G)return;V=G.createGain(),V.gain.value=S?S.value:.5,V.connect(G.destination)}var a=.15,o=G.createOscillator(),i=G.createGain(),l=document.querySelector(".wave-option.selected"),r=(o.type=l?l.getAttribute("data-wave-type"):"sine",Math.round(1e3*t)/1e3);o.frequency.setValueAtTime(r,n),i.gain.setValueAtTime(0,n),i.gain.linearRampToValueAtTime(a,n+.02),o.connect(i),i.connect(V),o.start(n),R[e]={oscillator:o,gainNode:i}}catch(e){console.error("Error playing note:",e)}},e.stopNote=function(t){var e=R[t];if(e)try{var n=G.currentTime,a=.1,o=e.gainNode;o.gain.cancelScheduledValues(n),o.gain.setValueAtTime(o.gain.value,n),o.gain.linearRampToValueAtTime(0,n+a),e.oscillator.stop(n+a+.01),delete R[t]}catch(e){console.error("Error stopping note:",e),delete R[t]}},e.render=function(e,t,n,a,o){var i=e.createOscillator(),e=e.createGain(),l=document.querySelector(".wave-option.selected"),l=(i.type=l?l.getAttribute("data-wave-type"):"sine",i.frequency.value=t.freq,.02),t=.1,r=.7;e.gain.setValueAtTime(0,n),e.gain.linearRampToValueAtTime(r,n+l),e.gain.setValueAtTime(r,n+a),e.gain.linearRampToValueAtTime(0,n+a+t),i.connect(e),e.connect(o),i.start(n),i.stop(n+a+t)},e.cleanup=function(){},e}},Ze={create:function(){var e=k.create("Gameboy");return e.init=function(){document.body.classList.add("gameboy-theme"),z()},e.playNote=function(e,t){try{if(!V||V.context!==G){if(!G)return;V=G.createGain(),V.gain.value=S?S.value:.5,V.connect(G.destination)}for(var n=G.currentTime,a=.12,o="square",i="white",l=0,r=.3,c=document.getElementById("gameboy-wave"),u=document.getElementById("gameboy-noise"),s=document.getElementById("gameboy-attack"),d=document.getElementById("gameboy-release"),m=(c&&(o=c.value),u&&(i=u.value),s&&(l=parseFloat(s.value)),d&&(r=parseFloat(d.value)),G.createOscillator()),p=G.createGain(),y=G.createBufferSource(),f=G.createGain(),g=2*G.sampleRate,v=G.createBuffer(1,g,G.sampleRate),h=v.getChannelData(0),E=0;E<g;E++)h[E]="white"===i?2*Math.random()-1:(2*Math.random()-1)*(E/g);y.buffer=v,y.loop=!0,m.type=o;var b=Math.round(1e3*t)/1e3;m.frequency.setValueAtTime(b,n),f.gain.value=.005,m.connect(p),y.connect(f),p.connect(V),f.connect(V),p.gain.setValueAtTime(0,n),p.gain.linearRampToValueAtTime(a,n+l),m.start(n),y.start(n),R[e]={oscillator:m,gainNode:p,noiseBuffer:y,noiseGain:f,releaseTime:r}}catch(e){console.error("Error playing Gameboy note:",e)}},e.stopNote=function(t){var e=R[t];if(e)try{var n=G.currentTime,a=e.releaseTime||.3;if(e.oscillator)try{e.oscillator.stop(n+a)}catch(e){}if(e.noiseBuffer)try{e.noiseBuffer.stop(n+.01)}catch(e){}e.gainNode&&(e.gainNode.gain.cancelScheduledValues(n),e.gainNode.gain.setValueAtTime(e.gainNode.gain.value,n),e.gainNode.gain.linearRampToValueAtTime(0,n+a)),e.noiseGain&&(e.noiseGain.gain.cancelScheduledValues(n),e.noiseGain.gain.setValueAtTime(e.noiseGain.gain.value,n),e.noiseGain.gain.linearRampToValueAtTime(0,n+.01)),delete R[t]}catch(e){console.error("Error stopping Gameboy note:",e),delete R[t]}},e.render=function(e,t,n,a,o){for(var i=document.getElementById("gameboy-wave"),l=document.getElementById("gameboy-noise"),r=document.getElementById("gameboy-attack"),c=document.getElementById("gameboy-release"),i=i?i.value:"square",u=l?l.value:"white",l=r?parseFloat(r.value):0,r=c?parseFloat(c.value):.3,c=.7,s=e.createOscillator(),d=e.createGain(),m=e.createBufferSource(),p=e.createGain(),y=.5*e.sampleRate,e=e.createBuffer(1,y,e.sampleRate),f=e.getChannelData(0),g=0;g<y;g++)f[g]=(2*Math.random()-1)*("white"===u?1:g/y);m.buffer=e,s.type=i,s.frequency.value=t.freq,p.gain.value=.02,d.gain.setValueAtTime(0,n),d.gain.linearRampToValueAtTime(c,n+l),d.gain.setValueAtTime(c,n+a),d.gain.linearRampToValueAtTime(0,n+a+r),s.connect(d),m.connect(p),d.connect(o),p.connect(o),s.start(n),m.start(n),s.stop(n+a+r),m.stop(n+a+r)},e.cleanup=function(){document.body.classList.remove("gameboy-theme"),M()},e}},$e={create:function(){var e=k.create("Guitar");return e.init=function(){document.body.classList.add("guitar-theme"),U()},e.playNote=function(e,t){try{if(G){for(var n=G.currentTime,a=(V&&V.context===G||(V=G.createGain(),V.gain.value=S?S.value:.5,V.connect(G.destination)),document.getElementById("guitar-type")),o=(document.getElementById("guitar-damping"),document.getElementById("guitar-body")),i=a?a.value:"acoustic",l=(o&&parseFloat(o.value),G.createOscillator()),r=G.createGain(),c=G.createOscillator(),u=G.createOscillator(),s=G.createGain(),d=G.createGain(),m=G.createBiquadFilter(),p=G.createBufferSource(),y=G.createBuffer(1,.05*G.sampleRate,G.sampleRate),f=y.getChannelData(0),g=G.createGain(),v=0;v<y.length;v++)f[v]=.2*(2*Math.random()-1);p.buffer=y;var h=Math.round(1e3*t)/1e3;l.type="sawtooth",l.frequency.setValueAtTime(h,n),c.type="sine",c.frequency.setValueAtTime(2*h,n),s.gain.value=.1,u.type="sine",u.frequency.setValueAtTime(3*h,n),d.gain.value=.08,"acoustic"===i?(m.type="lowpass",m.frequency.value=2.5*h,m.Q.value=1):"electric"===i?(m.type="lowpass",m.frequency.value=4*h,m.Q.value=2):"bass"===i&&(m.type="lowpass",m.frequency.value=1.5*h,m.Q.value=.8),l.connect(r),c.connect(s),u.connect(d),s.connect(r),d.connect(r),p.connect(g),g.connect(m),r.connect(m),m.connect(V),g.gain.setValueAtTime(.1,n),g.gain.exponentialRampToValueAtTime(.01,n+.05),r.gain.setValueAtTime(0,n),r.gain.linearRampToValueAtTime(.15,n+.01),l.start(n),c.start(n),u.start(n),p.start(n),R[e]={oscillator:l,gainNode:r,harmonic1:c,harmonic2:u,harmonicGain1:s,harmonicGain2:d,filter:m,pluckNoise:p,pluckGain:g}}}catch(e){console.error("Error playing guitar note:",e)}},e.stopNote=function(t){var e=R[t];if(e)try{var n=G.currentTime,a=.3;e.oscillator&&e.oscillator.stop(n+a),e.harmonic1&&e.harmonic1.stop(n+a),e.harmonic2&&e.harmonic2.stop(n+a),e.pluckNoise&&e.pluckNoise.stop(n+.01),e.gainNode&&(e.gainNode.gain.cancelScheduledValues(n),e.gainNode.gain.setValueAtTime(e.gainNode.gain.value,n),e.gainNode.gain.exponentialRampToValueAtTime(.01,n+a)),e.harmonicGain1&&(e.harmonicGain1.gain.cancelScheduledValues(n),e.harmonicGain1.gain.setValueAtTime(e.harmonicGain1.gain.value,n),e.harmonicGain1.gain.linearRampToValueAtTime(0,n+a)),e.harmonicGain2&&(e.harmonicGain2.gain.cancelScheduledValues(n),e.harmonicGain2.gain.setValueAtTime(e.harmonicGain2.gain.value,n),e.harmonicGain2.gain.linearRampToValueAtTime(0,n+a)),e.pluckGain&&(e.pluckGain.gain.cancelScheduledValues(n),e.pluckGain.gain.setValueAtTime(e.pluckGain.gain.value,n),e.pluckGain.gain.linearRampToValueAtTime(0,n+.01)),delete R[t]}catch(e){console.error("Error stopping guitar note:",e),delete R[t]}},e.render=function(e,t,n,a,o){},e.cleanup=function(){document.body.classList.remove("guitar-theme"),Q()},e}},_e={create:function(){var e=k.create("SNES");return e.init=function(){document.body.classList.add("snes-theme"),P()},e.playNote=function(e,t){try{if(!V||V.context!==G){if(!G)return;V=G.createGain(),V.gain.value=S?S.value:.5,V.connect(G.destination)}for(var n=G.currentTime,a=.15,o=document.getElementById("snes-instrument"),i=document.getElementById("snes-reverb"),l=document.getElementById("snes-attack"),r=document.getElementById("snes-release"),c=o?o.value:"piano",u=i?parseFloat(i.value):.3,s=l?parseFloat(l.value):.05,d=r?parseFloat(r.value):.5,m=G.createOscillator(),p=G.createGain(),y=G.createOscillator(),f=G.createOscillator(),g=G.createGain(),v=G.createGain(),h=G.createBiquadFilter(),E=G.createBiquadFilter(),b=G.createConvolver(),x=G.createGain(),q=G.createGain(),T=G.sampleRate*u*2,C=G.createBuffer(2,T,G.sampleRate),w=0;w<2;w++)for(var A=C.getChannelData(w),k=0;k<T;k++)A[k]=(2*Math.random()-1)*Math.pow(1-k/T,2);b.buffer=C,"piano"===c?(m.type="triangle",y.type="sine",f.type="sine",y.frequency.value=2*t,f.frequency.value=3*t,g.gain.value=.2,v.gain.value=.1,h.type="lowpass",h.frequency.value=4*t,h.Q.value=1,E.type="highpass",E.frequency.value=.5*t,E.Q.value=.5):"strings"===c?(m.type="sawtooth",y.type="sawtooth",f.type="sine",y.frequency.value=2*t,f.frequency.value=3*t,g.gain.value=.3,v.gain.value=.2,h.type="lowpass",h.frequency.value=3*t,h.Q.value=.8,E.type="highpass",E.frequency.value=.4*t,E.Q.value=.5):"brass"===c?(m.type="square",y.type="square",f.type="sine",y.frequency.value=2*t,f.frequency.value=1.5*t,g.gain.value=.4,v.gain.value=.3,h.type="lowpass",h.frequency.value=2.5*t,h.Q.value=1.5,E.type="highpass",E.frequency.value=.6*t,E.Q.value=.7):"woodwind"===c?(m.type="triangle",y.type="sine",f.type="sine",y.frequency.value=2.5*t,f.frequency.value=3.5*t,g.gain.value=.25,v.gain.value=.15,h.type="lowpass",h.frequency.value=3.5*t,h.Q.value=1.2,E.type="highpass",E.frequency.value=.5*t,E.Q.value=.6):"percussion"===c&&(m.type="square",y.type="square",f.type="triangle",y.frequency.value=1.5*t,f.frequency.value=.5*t,g.gain.value=.3,v.gain.value=.2,h.type="bandpass",h.frequency.value=1.2*t,h.Q.value=2,E.type="highpass",E.frequency.value=.3*t,E.Q.value=.8);var B=Math.round(1e3*t)/1e3;m.frequency.setValueAtTime(B,n),x.gain.value=.5*u,q.gain.value=1-.3*u,m.connect(p),y.connect(g),f.connect(v),g.connect(p),v.connect(p),p.connect(h),h.connect(E),E.connect(q),E.connect(x),q.connect(V),x.connect(b),b.connect(V),p.gain.setValueAtTime(0,n),p.gain.linearRampToValueAtTime(a,n+s),m.start(n),y.start(n),f.start(n),R[e]={oscillator:m,gainNode:p,harmonic1:y,harmonic2:f,harmonicGain1:g,harmonicGain2:v,filter:h,filter2:E,convolver:b,reverbGain:x,dryGain:q,releaseTime:d}}catch(e){console.error("Error playing SNES note:",e)}},e.stopNote=function(t){var e=R[t];if(e&&!e.isStopping){e.isStopping=!0;try{var n=G.currentTime,a=e.releaseTime||.5;e.oscillator&&e.oscillator.stop(n+a),e.harmonic1&&e.harmonic1.stop(n+a),e.harmonic2&&e.harmonic2.stop(n+a),e.gainNode&&(e.gainNode.gain.cancelScheduledValues(n),e.gainNode.gain.setValueAtTime(e.gainNode.gain.value,n),e.gainNode.gain.linearRampToValueAtTime(0,n+a)),e.harmonicGain1&&(e.harmonicGain1.gain.cancelScheduledValues(n),e.harmonicGain1.gain.setValueAtTime(e.harmonicGain1.gain.value,n),e.harmonicGain1.gain.linearRampToValueAtTime(0,n+a)),e.harmonicGain2&&(e.harmonicGain2.gain.cancelScheduledValues(n),e.harmonicGain2.gain.setValueAtTime(e.harmonicGain2.gain.value,n),e.harmonicGain2.gain.linearRampToValueAtTime(0,n+a)),e.reverbGain&&(e.reverbGain.gain.cancelScheduledValues(n),e.reverbGain.gain.setValueAtTime(e.reverbGain.gain.value,n),e.reverbGain.gain.linearRampToValueAtTime(0,n+a)),e.dryGain&&(e.dryGain.gain.cancelScheduledValues(n),e.dryGain.gain.setValueAtTime(e.dryGain.gain.value,n),e.dryGain.gain.linearRampToValueAtTime(0,n+a)),setTimeout(function(){R[t]&&R[t].isStopping&&(R[t]=null,r(t))},1e3*a)}catch(e){console.error("Error stopping SNES note:",e),R[t]=null,r(t)}}},e.render=function(e,t,n,a,o){var i=document.getElementById("snes-instrument"),l=document.getElementById("snes-attack"),r=document.getElementById("snes-release"),i=i?i.value:"piano",l=l?parseFloat(l.value):.05,r=r?parseFloat(r.value):.5,c=.7,u=e.createOscillator(),s=e.createGain(),e=e.createBiquadFilter();"piano"===i?(u.type="triangle",e.type="lowpass",e.frequency.value=4*t.freq):"strings"===i?(u.type="sawtooth",e.type="lowpass",e.frequency.value=3*t.freq):(u.type="square",e.type="lowpass",e.frequency.value=2.5*t.freq),u.frequency.value=t.freq,s.gain.setValueAtTime(0,n),s.gain.linearRampToValueAtTime(c,n+l),s.gain.setValueAtTime(c,n+a),s.gain.linearRampToValueAtTime(0,n+a+r),u.connect(e),e.connect(s),s.connect(o),u.start(n),u.stop(n+a+r)},e.cleanup=function(){document.body.classList.remove("snes-theme"),j()},e}},et={create:function(){var e=k.create("Drums & Percussion"),B={};return e.init=function(){document.body.classList.add("drums-theme"),H()},e.playNote=function(e,t){try{if(G){V&&V.context===G||(V=G.createGain(),V.gain.value=S?S.value:.5,V.connect(G.destination));for(var n=G.currentTime,a=.5,o=1,i=.5,l=document.getElementById("drums-type"),r=document.getElementById("drums-pitch"),c=document.getElementById("drums-decay"),u=l?l.value:"kick",s=(r&&(o=parseFloat(r.value)),c&&(i=parseFloat(c.value)),G.createBufferSource()),d=G.createGain(),m=G.createBiquadFilter(),p=2*G.sampleRate,y=G.createBuffer(1,p,G.sampleRate),f=y.getChannelData(0),g=0;g<p;g++)f[g]=2*Math.random()-1;s.buffer=y,s.loop=!0;var v=G.createOscillator(),h=G.createGain();if("kick"===u)v.type="sine",v.frequency.setValueAtTime(t*o,n),v.frequency.exponentialRampToValueAtTime(.01,n+i),h.gain.setValueAtTime(a,n),h.gain.exponentialRampToValueAtTime(.01,n+i),v.connect(h),h.connect(V),v.start(n),v.stop(n+i),B[e]={oscillator:v,gainNode:h};else if("snare"===u)v.type="triangle",v.frequency.setValueAtTime(t*o,n),h.gain.setValueAtTime(.5*a,n),h.gain.exponentialRampToValueAtTime(.01,n+i),m.type="highpass",m.frequency.value=1e3+t/100,d.gain.setValueAtTime(.5*a,n),d.gain.exponentialRampToValueAtTime(.01,n+i),v.connect(h),s.connect(m),m.connect(d),h.connect(V),d.connect(V),v.start(n),s.start(n),B[e]={oscillator:v,gainNode:h,noiseBuffer:s,noiseGain:d};else if("tom"===u)v.type="square",v.frequency.setValueAtTime(t*o,n),v.frequency.exponentialRampToValueAtTime(.01,n+i),h.gain.setValueAtTime(a,n),h.gain.exponentialRampToValueAtTime(.01,n+i),v.connect(h),h.connect(V),v.start(n),v.stop(n+i),B[e]={oscillator:v,gainNode:h};else if("hihat"===u){const E=G.createBufferSource(),p=.5*G.sampleRate,b=G.createBuffer(1,p,G.sampleRate),f=b.getChannelData(0);for(let e=0;e<p;e++)f[e]=2*Math.random()-1;E.buffer=b;const x=G.createOscillator(),q=(x.type="square",t*o),T=(x.frequency.value=q,G.createBiquadFilter()),C=(T.type="bandpass",T.frequency.value=q,T.Q.value=10,G.createBiquadFilter()),w=(C.type="highpass",C.frequency.value=8e3,G.createGain()),A=G.createGain(),k=G.createGain();w.gain.value=.3,A.gain.value=.2,k.gain.setValueAtTime(.5*a,n),k.gain.exponentialRampToValueAtTime(.01,n+.2*i),E.connect(C),C.connect(w),w.connect(k),x.connect(T),T.connect(A),A.connect(k),k.connect(V),E.start(n),x.start(n),E.stop(n+.3*i),x.stop(n+.3*i),B[e]={noiseSource:E,oscillator:x,gain:k}}else"cymbal"===u&&(m.type="highpass",m.frequency.value=3e3+t/15,d.gain.setValueAtTime(.4*a,n),d.gain.exponentialRampToValueAtTime(.01,n+2*i),s.connect(m),m.connect(d),d.connect(V),s.start(n),B[e]={noiseBuffer:s,noiseGain:d})}}catch(e){console.error("Error playing drum note:",e)}},e.stopNote=function(t){var e=B[t];if(e)try{var n=G.currentTime,a=.05;if(e.oscillator)try{e.oscillator.stop(n+a)}catch(e){}if(e.noiseBuffer)try{e.noiseBuffer.stop(n+a)}catch(e){}if(e.noiseSource)try{e.noiseSource.stop(n+a)}catch(e){}e.gainNode&&(e.gainNode.gain.cancelScheduledValues(n),e.gainNode.gain.setValueAtTime(e.gainNode.gain.value,n),e.gainNode.gain.exponentialRampToValueAtTime(.01,n+a)),e.noiseGain&&(e.noiseGain.gain.cancelScheduledValues(n),e.noiseGain.gain.setValueAtTime(e.noiseGain.gain.value,n),e.noiseGain.gain.exponentialRampToValueAtTime(.01,n+a)),e.gain&&(e.gain.gain.cancelScheduledValues(n),e.gain.gain.setValueAtTime(e.gain.gain.value,n),e.gain.gain.exponentialRampToValueAtTime(.01,n+a)),delete B[t]}catch(e){console.error("Error stopping drum note:",e),delete B[t]}},e.render=function(e,t,n,a,o){for(var i,l,r,c,u,s,d=document.getElementById("drums-type"),m=document.getElementById("drums-pitch"),p=document.getElementById("drums-decay"),d=d?d.value:"kick",m=m?parseFloat(m.value):1,p=p?parseFloat(p.value):.5,y=2*e.sampleRate,f=e.createBuffer(1,y,e.sampleRate),g=f.getChannelData(0),v=0;v<y;v++)g[v]=2*Math.random()-1;"kick"===d?(u=e.createOscillator(),s=e.createGain(),u.type="sine",u.frequency.setValueAtTime(t.freq*m,n),u.frequency.exponentialRampToValueAtTime(.01,n+p),s.gain.setValueAtTime(.7,n),s.gain.exponentialRampToValueAtTime(.01,n+p),u.connect(s),s.connect(o),u.start(n),u.stop(n+p)):"snare"===d?(u=e.createOscillator(),s=e.createGain(),i=e.createBufferSource(),r=e.createGain(),l=e.createBiquadFilter(),i.buffer=f,u.type="triangle",u.frequency.value=t.freq*m,l.type="highpass",l.frequency.value=5e3,s.gain.setValueAtTime(.5,n),r.gain.setValueAtTime(.5,n),s.gain.exponentialRampToValueAtTime(.01,n+p),r.gain.exponentialRampToValueAtTime(.01,n+p),u.connect(s),i.connect(l),l.connect(r),s.connect(o),r.connect(o),u.start(n),i.start(n),u.stop(n+p),i.stop(n+p)):"hihat"===d||"cymbal"===d?(u=e.createOscillator(),i=e.createBufferSource(),i.buffer=f,f=e.createBiquadFilter(),f.type="bandpass",f.frequency.value=t.freq*m,f.Q.value=10,l=e.createBiquadFilter(),l.type="highpass",l.frequency.value="hihat"===d?8e3:3e3,s=e.createGain(),r=e.createGain(),c=e.createGain(),s.gain.value="hihat"===d?.2:.3,r.gain.value="hihat"===d?.3:.4,d="hihat"===d?.2*p:2*p,c.gain.setValueAtTime(.7,n),c.gain.exponentialRampToValueAtTime(.01,n+d),i.connect(l),l.connect(r),r.connect(c),u.connect(f),f.connect(s),s.connect(c),c.connect(o),u.start(n),i.start(n),u.stop(n+d),i.stop(n+d)):(u=e.createOscillator(),s=e.createGain(),u.type="square",u.frequency.setValueAtTime(t.freq*m,n),u.frequency.exponentialRampToValueAtTime(.01,n+p),s.gain.setValueAtTime(.7,n),s.gain.exponentialRampToValueAtTime(.01,n+p),u.connect(s),s.connect(o),u.start(n),u.stop(n+p))},e.cleanup=function(){document.body.classList.remove("drums-theme"),W()},e}},tt={create:function(){var e=k.create("Bell");return e.init=function(){document.body.classList.add("bell-theme"),J()},e.playNote=function(e,t){try{var n,a,o,i,l,r,c,u,s,d,m,p,y,f,g,v,h,E,b,x,q,T;G?(n=G.currentTime,a=(V&&V.context===G||(V=G.createGain(),V.gain.value=S?parseFloat(S.value):.5,V.connect(G.destination)),document.getElementById("bell-decay")),o=document.getElementById("bell-brightness"),i=a?parseFloat(a.value):2.5,l=o?parseFloat(o.value):.5,r=t,c=2.4*t,u=5.95*t,s=8.2*t,d=.5,m=.3*l,p=.2*l,y=.1*l,f=G.createOscillator(),g=G.createOscillator(),v=G.createOscillator(),h=G.createOscillator(),E=G.createGain(),b=G.createGain(),x=G.createGain(),q=G.createGain(),T=G.createGain(),T.gain.value=.8,f.frequency.value=r,g.frequency.value=c,v.frequency.value=u,h.frequency.value=s,f.type="sine",g.type="sine",v.type="sine",h.type="sine",E.gain.setValueAtTime(0,n),E.gain.linearRampToValueAtTime(d,n+.01),E.gain.exponentialRampToValueAtTime(.001,n+i),b.gain.setValueAtTime(0,n),b.gain.linearRampToValueAtTime(m,n+.01),b.gain.exponentialRampToValueAtTime(.001,n+.8*i),x.gain.setValueAtTime(0,n),x.gain.linearRampToValueAtTime(p,n+.01),x.gain.exponentialRampToValueAtTime(.001,n+.6*i),q.gain.setValueAtTime(0,n),q.gain.linearRampToValueAtTime(y,n+.01),q.gain.exponentialRampToValueAtTime(.001,n+.4*i),f.connect(E),g.connect(b),v.connect(x),h.connect(q),E.connect(T),b.connect(T),x.connect(T),q.connect(T),T.connect(V),f.start(n),g.start(n),v.start(n),h.start(n),f.stop(n+i+.1),g.stop(n+i+.1),v.stop(n+i+.1),h.stop(n+i+.1),R[e]={masterGain:T,oscillators:[f,g,v,h]}):console.error("Audio context not initialized")}catch(e){console.error("Error playing bell note:",e)}},e.stopNote=function(t){var e=R[t];if(e)try{var n=G.currentTime,a=.05;e.masterGain&&(e.masterGain.gain.cancelScheduledValues(n),e.masterGain.gain.setValueAtTime(e.masterGain.gain.value,n),e.masterGain.gain.linearRampToValueAtTime(0,n+a)),e.oscillators&&e.oscillators.forEach(function(e){e.stop(n+a)}),delete R[t]}catch(e){console.error("Error stopping bell note:",e),delete R[t]}},e.render=function(e,t,n,a,o){var i=document.getElementById("bell-decay"),l=document.getElementById("bell-brightness"),r=i?parseFloat(i.value):2.5,i=l?parseFloat(l.value):.5,l=t.freq,t=.5,c=.3*i,u=.2*i,i=.1*i,s=[{f:l,g:t},{f:2.4*l,g:c},{f:5.95*l,g:u},{f:8.2*l,g:i}],d=e.createGain();d.gain.value=.8,d.connect(o);for(var m=0;m<s.length;m++){var p=e.createOscillator(),y=e.createGain();p.type="sine",p.frequency.value=s[m].f,y.gain.setValueAtTime(0,n),y.gain.linearRampToValueAtTime(s[m].g,n+.01),y.gain.exponentialRampToValueAtTime(.001,n+r*(1-.1*m)),p.connect(y),y.connect(d),p.start(n),p.stop(n+r+.1)}},e.cleanup=function(){document.body.classList.remove("bell-theme"),K()},e}},nt={create:function(){var e=k.create("Flute");return e.init=function(){document.body.classList.add("flute-theme"),X()},e.playNote=function(e,t){try{var n=G.currentTime;if(!V||V.context!==G){if(!G)return;V=G.createGain(),V.gain.value=S?S.value:.5,V.connect(G.destination)}var a=document.getElementById("flute-breath"),o=document.getElementById("flute-vibrato"),i=a?parseFloat(a.value):.1,l=o?parseFloat(o.value):5,r=G.createOscillator(),c=(r.type="triangle",r.frequency.setValueAtTime(t,n),null),u=null,s=(0<l&&(c=G.createOscillator(),c.type="sine",c.frequency.value=l,u=G.createGain(),u.gain.value=3,c.connect(u),u.connect(r.frequency),c.start(n)),null),d=null,m=null;if(0<i){for(var s=G.createBufferSource(),p=2*G.sampleRate,y=G.createBuffer(1,p,G.sampleRate),f=y.getChannelData(0),g=0;g<p;g++)f[g]=2*Math.random()-1;s.buffer=y,s.loop=!0,d=G.createBiquadFilter(),d.type="highpass",d.frequency.value=1e3,m=G.createGain(),m.gain.setValueAtTime(i,n),m.gain.exponentialRampToValueAtTime(.001,n+.3),s.connect(d),d.connect(m),m.connect(V),s.start(n)}var v=G.createGain();v.gain.setValueAtTime(0,n),v.gain.linearRampToValueAtTime(.3,n+.1),v.gain.linearRampToValueAtTime(.25,n+.2),v.gain.linearRampToValueAtTime(.3,n+.4),r.connect(v),v.connect(V),r.start(n),R[e]={osc:r,mainGain:v,lfo:c,lfoGain:u,noiseNode:s}}catch(e){console.error("Error playing flute note:",e)}},e.stopNote=function(t){var e=R[t];if(e)try{var n=G.currentTime,a=.3;if(e.lfo&&e.lfo.stop(n+a),e.noiseNode)try{e.noiseNode.stop(n+a)}catch(e){}e.mainGain&&(e.mainGain.gain.cancelScheduledValues(n),e.mainGain.gain.setValueAtTime(e.mainGain.gain.value,n),e.mainGain.gain.exponentialRampToValueAtTime(.001,n+a),e.osc.stop(n+a)),delete R[t]}catch(e){console.error("Error stopping flute note:",e),delete R[t]}},e.render=function(e,t,n,a,o){var i=document.getElementById("flute-breath"),l=document.getElementById("flute-vibrato"),i=i?parseFloat(i.value):.1,l=l?parseFloat(l.value):5,t=t.freq,r=e.createOscillator();if(r.type="triangle",r.frequency.setValueAtTime(t,n),0<l&&(t=e.createOscillator(),t.type="sine",t.frequency.value=l,l=e.createGain(),l.gain.value=3,t.connect(l),l.connect(r.frequency),t.start(n),t.stop(n+a+.5)),0<i){for(var l=e.createBufferSource(),c=.5*e.sampleRate,t=e.createBuffer(1,c,e.sampleRate),u=t.getChannelData(0),s=0;s<c;s++)u[s]=2*Math.random()-1;l.buffer=t,l.loop=!0;var t=e.createBiquadFilter(),d=(t.type="highpass",t.frequency.value=1e3,e.createGain());d.gain.setValueAtTime(i,n),d.gain.exponentialRampToValueAtTime(.001,n+.3),l.connect(t),t.connect(d),d.connect(o),l.start(n),l.stop(n+.5)}i=e.createGain(),i.gain.setValueAtTime(0,n),i.gain.linearRampToValueAtTime(.3,n+.1),i.gain.linearRampToValueAtTime(.25,n+.2),i.gain.linearRampToValueAtTime(.3,n+.4),t=.3;i.gain.setValueAtTime(.3,n+a),i.gain.exponentialRampToValueAtTime(.001,n+a+t),r.connect(i),i.connect(o),r.start(n),r.stop(n+a+t)},e.cleanup=function(){document.body.classList.remove("flute-theme"),Y()},e}},at={create:function(){var e=k.create("Violin");return e.init=function(){document.body.classList.add("violin-theme"),Z()},e.playNote=function(e,t){try{var n=G.currentTime;if(!V||V.context!==G){if(!G)return;V=G.createGain(),V.gain.value=S?S.value:.5,V.connect(G.destination)}for(var a=document.getElementById("violin-attack"),o=document.getElementById("violin-vibrato"),i=document.getElementById("violin-filter"),l=a?parseFloat(a.value):.2,r=o?parseFloat(o.value):6,c=i?parseFloat(i.value):2500,u=G.createOscillator(),s=(u.type="sawtooth",u.frequency.setValueAtTime(t,n),u.start(n),null),d=null,m=(0<r&&(s=G.createOscillator(),s.type="sine",s.frequency.value=r,d=G.createGain(),d.gain.value=8,s.connect(d),d.connect(u.frequency),s.start(n)),G.createBiquadFilter()),p=(m.type="lowpass",m.frequency.value=c,m.Q.value=1,G.createConvolver()),y=G.createGain(),f=G.createGain(),g=1.5*G.sampleRate,v=G.createBuffer(2,g,G.sampleRate),h=0;h<2;h++)for(var E=v.getChannelData(h),b=0;b<g;b++)E[b]=(2*Math.random()-1)*Math.pow(1-b/g,2);p.buffer=v,y.gain.value=.4,f.gain.value=.6,u.connect(m),m.connect(f),m.connect(y),f.connect(V),y.connect(p),p.connect(V);var x=G.createGain();x.gain.setValueAtTime(0,n),x.gain.linearRampToValueAtTime(.4,n+l),u.disconnect(),u.connect(x),x.connect(m),R[e]={osc:u,masterGain:x,lfo:s,lfoGain:d}}catch(e){console.error("Error playing violin note:",e);try{u&&u.stop()
}catch(e){}}},e.stopNote=function(t){var e=R[t];if(e&&!e.isStopping){e.isStopping=!0;try{var n=G.currentTime,a=.4;try{e.lfo&&e.lfo.stop(n+a)}catch(e){}if(e.masterGain){e.masterGain.gain.cancelScheduledValues(n),e.masterGain.gain.setValueAtTime(e.masterGain.gain.value,n),e.masterGain.gain.exponentialRampToValueAtTime(.001,n+a);try{e.osc.stop(n+a)}catch(e){}}setTimeout(function(){R[t]&&R[t].isStopping&&(delete R[t],r(t))},1e3*a)}catch(e){console.error("Error stopping violin note:",e),delete R[t],r(t)}}},e.render=function(e,t,n,a,o){for(var i=document.getElementById("violin-attack"),l=document.getElementById("violin-vibrato"),r=document.getElementById("violin-filter"),i=i?parseFloat(i.value):.2,l=l?parseFloat(l.value):6,r=r?parseFloat(r.value):2500,t=t.freq,c=e.createOscillator(),l=(c.type="sawtooth",c.frequency.setValueAtTime(t,n),0<l&&(t=e.createOscillator(),t.type="sine",t.frequency.value=l,l=e.createGain(),l.gain.value=8,t.connect(l),l.connect(c.frequency),t.start(n),t.stop(n+a+.5)),e.createBiquadFilter()),t=(l.type="lowpass",l.frequency.value=r,l.Q.value=1,e.createConvolver()),r=e.createGain(),u=e.createGain(),s=1.5*e.sampleRate,d=e.createBuffer(2,s,e.sampleRate),m=0;m<2;m++)for(var p=d.getChannelData(m),y=0;y<s;y++)p[y]=(2*Math.random()-1)*Math.pow(1-y/s,2);t.buffer=d,r.gain.value=.4,u.gain.value=.6,c.connect(l),l.connect(u),l.connect(r),u.connect(o),r.connect(t),t.connect(o);u=e.createGain(),u.gain.setValueAtTime(0,n),u.gain.linearRampToValueAtTime(.4,n+i),r=.4;u.gain.setValueAtTime(.4,n+a),u.gain.exponentialRampToValueAtTime(.001,n+a+r),c.disconnect(),c.connect(u),u.connect(l),c.start(n),c.stop(n+a+r)},e.cleanup=function(){document.body.classList.remove("violin-theme"),$()},e}},ot={create:function(){var e=k.create("Ukulele");return e.init=function(){document.body.classList.add("ukulele-theme"),_()},e.playNote=function(e,t){try{var n=G.currentTime;if(!V||V.context!==G){if(!G)return;V=G.createGain(),V.gain.value=S?S.value:.5,V.connect(G.destination)}for(var a=document.getElementById("ukulele-decay"),o=document.getElementById("ukulele-nylon"),i=a?parseFloat(a.value):.8,l=o?parseFloat(o.value):4,r=G.createOscillator(),c=(r.type="sawtooth",r.frequency.setValueAtTime(t,n),r.start(n),G.createOscillator()),u=(c.type="sine",c.frequency.setValueAtTime(2.5*t,n),c.start(n),G.createGain()),s=(u.gain.value=.1,G.createBiquadFilter()),d=(s.type="lowpass",s.frequency.value=t*l,s.Q.value=1.5,G.createBufferSource()),m=G.createBuffer(1,.05*G.sampleRate,G.sampleRate),p=m.getChannelData(0),y=0;y<m.length;y++)p[y]=.3*(2*Math.random()-1);d.buffer=m;var f=G.createGain(),g=(d.connect(f),f.connect(s),d.start(n),f.gain.setValueAtTime(.2,n),f.gain.exponentialRampToValueAtTime(.01,n+.05),G.createGain());r.connect(g),c.connect(u),u.connect(g),g.connect(s),s.connect(V),g.gain.setValueAtTime(0,n),g.gain.linearRampToValueAtTime(.4,n+.02),g.gain.exponentialRampToValueAtTime(.001,n+i),R[e]={osc:r,harmonic1:c,masterGain:g,pluckNoise:d}}catch(e){console.error("Error playing ukulele note:",e)}},e.stopNote=function(t){var e=R[t];if(e&&!e.isStopping){e.isStopping=!0;try{var n=G.currentTime,a=.1;try{e.osc&&e.osc.stop(n+a),e.harmonic1&&e.harmonic1.stop(n+a)}catch(e){}if(e.pluckNoise)try{e.pluckNoise.stop(n+a)}catch(e){}e.masterGain&&(e.masterGain.gain.cancelScheduledValues(n),e.masterGain.gain.setValueAtTime(e.masterGain.gain.value,n),e.masterGain.gain.exponentialRampToValueAtTime(.001,n+a)),setTimeout(function(){R[t]===e&&(delete R[t],r(t))},1e3*a)}catch(e){console.error("Error stopping ukulele note:",e),delete R[t],r(t)}}},e.render=function(e,t,n,a,o){var i=document.getElementById("ukulele-decay"),l=document.getElementById("ukulele-nylon"),i=(i&&parseFloat(i.value),l?parseFloat(l.value):4),l=t.freq,t=e.createOscillator(),r=(t.type="sawtooth",t.frequency.value=l,e.createOscillator()),c=(r.type="sine",r.frequency.value=2.5*l,e.createGain()),u=(c.gain.value=.1,e.createBiquadFilter()),l=(u.type="lowpass",u.frequency.value=l*i,u.Q.value=1.5,e.createGain()),i=(t.connect(l),r.connect(c),c.connect(l),l.connect(u),u.connect(o),.1);l.gain.setValueAtTime(0,n),l.gain.linearRampToValueAtTime(.4,n+.02),l.gain.setValueAtTime(.4,n+a),l.gain.exponentialRampToValueAtTime(.001,n+a+i),t.start(n),r.start(n),t.stop(n+a+i),r.stop(n+a+i)},e.cleanup=function(){document.body.classList.remove("ukulele-theme"),ee()},e}},it={create:function(){var e=k.create("Tuba");return e.init=function(){document.body.classList.add("tuba-theme"),te()},e.playNote=function(e,t){try{var n=G.currentTime;if(!V||V.context!==G){if(!G)return;V=G.createGain(),V.gain.value=S?S.value:.5,V.connect(G.destination)}var a=document.getElementById("tuba-attack"),o=document.getElementById("tuba-release"),i=document.getElementById("tuba-brilliance"),l=document.getElementById("tuba-vibrato"),r=a?parseFloat(a.value):.2,c=o?parseFloat(o.value):.4,u=i?parseFloat(i.value):2.5,s=l?parseFloat(l.value):4,d=G.createOscillator(),m=(d.type="sawtooth",d.frequency.setValueAtTime(t,n),d.start(n),G.createOscillator()),p=(m.type="sawtooth",m.frequency.setValueAtTime(1.005*t,n),m.start(n),G.createOscillator()),y=(p.type="sine",p.frequency.value=s,G.createGain()),f=(y.gain.value=6,p.connect(y),y.connect(d.frequency),y.connect(m.frequency),p.start(n),G.createBiquadFilter()),g=(f.type="lowpass",f.frequency.value=t*u,f.Q.value=1,G.createGain()),v=(g.gain.value=.5,G.createGain()),h=(v.gain.value=.5,d.connect(g),m.connect(v),g.connect(f),v.connect(f),G.createGain());f.connect(h),h.connect(V),h.gain.setValueAtTime(0,n),h.gain.linearRampToValueAtTime(.5,n+r),R[e]={osc1:d,osc2:m,lfo:p,masterGain:h,releaseTime:c}}catch(e){console.error("Error playing tuba note:",e)}},e.stopNote=function(t){var e=R[t];if(e&&!e.isStopping){e.isStopping=!0;try{var n=G.currentTime,a=e.releaseTime||.4;try{e.osc1&&e.osc1.stop(n+a),e.osc2&&e.osc2.stop(n+a),e.lfo&&e.lfo.stop(n+a)}catch(e){}e.masterGain&&(e.masterGain.gain.cancelScheduledValues(n),e.masterGain.gain.setValueAtTime(e.masterGain.gain.value,n),e.masterGain.gain.exponentialRampToValueAtTime(.001,n+a)),setTimeout(function(){R[t]&&R[t].isStopping&&(delete R[t],r(t))},1e3*a)}catch(e){console.error("Error stopping tuba note:",e),delete R[t],r(t)}}},e.render=function(e,t,n,a,o){var i=document.getElementById("tuba-attack"),l=document.getElementById("tuba-release"),r=document.getElementById("tuba-brilliance"),c=document.getElementById("tuba-vibrato"),i=i?parseFloat(i.value):.2,l=l?parseFloat(l.value):.4,r=r?parseFloat(r.value):2.5,c=c?parseFloat(c.value):4,t=t.freq,u=e.createOscillator(),s=(u.type="sawtooth",u.frequency.setValueAtTime(t,n),e.createOscillator()),d=(s.type="sawtooth",s.frequency.setValueAtTime(1.005*t,n),e.createOscillator()),c=(d.type="sine",d.frequency.value=c,e.createGain()),c=(c.gain.value=6,d.connect(c),c.connect(u.frequency),c.connect(s.frequency),d.start(n),d.stop(n+a+l),e.createBiquadFilter()),d=(c.type="lowpass",c.frequency.value=t*r,c.Q.value=1,e.createGain()),t=(d.gain.value=.5,e.createGain()),r=(t.gain.value=.5,e.createGain());u.connect(d),s.connect(t),d.connect(c),t.connect(c),c.connect(r),r.connect(o),r.gain.setValueAtTime(0,n),r.gain.linearRampToValueAtTime(.5,n+i),r.gain.setValueAtTime(.5,n+a),r.gain.exponentialRampToValueAtTime(.001,n+a+l),u.start(n),s.start(n),u.stop(n+a+l),s.stop(n+a+l)},e.cleanup=function(){document.body.classList.remove("tuba-theme"),ne()},e}},lt={create:function(){var e=k.create("Custom");return e.init=function(){document.body.classList.add("custom-theme"),ae()},e.playNote=function(e,t){try{if(window.customSampleBuffer){var n=G.currentTime;if(!V||V.context!==G){if(!G)return;V=G.createGain(),V.gain.value=S?S.value:.5,V.connect(G.destination)}var a=G.createBufferSource(),o=(a.buffer=window.customSampleBuffer,a.loop=!0,window.customSampleBaseFreq||261.626),i=t/o,l=(a.playbackRate.value=i,G.createGain());a.connect(l),l.connect(V),a.start(n),l.gain.setValueAtTime(0,n),l.gain.linearRampToValueAtTime(.8,n+.05),l.gain.linearRampToValueAtTime(.7,n+.2),R[e]={source:a,gainNode:l}}}catch(e){console.error("Error playing custom note:",e)}},e.stopNote=function(t){var e=R[t];if(e&&!e.isStopping){e.isStopping=!0;try{var n=G.currentTime,a=.2;if(e.gainNode){e.gainNode.gain.cancelScheduledValues(n),e.gainNode.gain.setValueAtTime(e.gainNode.gain.value,n),e.gainNode.gain.exponentialRampToValueAtTime(.001,n+a);try{e.source.stop(n+a)}catch(e){}}setTimeout(function(){R[t]&&R[t].isStopping&&(delete R[t],r(t))},1e3*a)}catch(e){console.error("Error stopping custom note:",e),delete R[t],r(t)}}},e.render=function(e,t,n,a,o){var i,l;window.customSampleBuffer&&(t=t.freq,l=window.customSampleBaseFreq||261.626,i=e.createBufferSource(),i.buffer=window.customSampleBuffer,i.loop=!0,t=t/l,i.playbackRate.value=t,l=e.createGain(),i.connect(l),l.connect(o),t=.2,l.gain.setValueAtTime(0,n),l.gain.linearRampToValueAtTime(.8,n+.05),l.gain.linearRampToValueAtTime(.7,n+.2),l.gain.setValueAtTime(.7,n+a),l.gain.exponentialRampToValueAtTime(.001,n+a+t),i.start(n),i.stop(n+a+t))},e.cleanup=function(){document.body.classList.remove("custom-theme"),oe()},e}},B=[{key:"",note:"C1",freq:32.703,type:"white"},{key:"",note:"C#1",freq:34.648,type:"black"},{key:"",note:"D1",freq:36.708,type:"white"},{key:"",note:"D#1",freq:38.891,type:"black"},{key:"",note:"E1",freq:41.203,type:"white"},{key:"",note:"F1",freq:43.654,type:"white"},{key:"",note:"F#1",freq:46.249,type:"black"},{key:"",note:"G1",freq:49,type:"white"},{key:"",note:"G#1",freq:51.913,type:"black"},{key:"",note:"A1",freq:55,type:"white"},{key:"",note:"A#1",freq:58.27,type:"black"},{key:"",note:"B1",freq:61.735,type:"white"},{key:"",note:"C2",freq:65.406,type:"white"},{key:"",note:"C#2",freq:69.296,type:"black"},{key:"",note:"D2",freq:73.416,type:"white"},{key:"",note:"D#2",freq:77.782,type:"black"},{key:"",note:"E2",freq:82.407,type:"white"},{key:"",note:"F2",freq:87.307,type:"white"},{key:"",note:"F#2",freq:92.499,type:"black"},{key:"",note:"G2",freq:98,type:"white"},{key:"",note:"G#2",freq:103.826,type:"black"},{key:"",note:"A2",freq:110,type:"white"},{key:"",note:"A#2",freq:116.541,type:"black"},{key:"",note:"B2",freq:123.471,type:"white"},{key:"z",note:"C3",freq:130.813,type:"white"},{key:"Z",note:"C#3",freq:138.591,type:"black"},{key:"x",note:"D3",freq:146.832,type:"white"},{key:"X",note:"D#3",freq:155.563,type:"black"},{key:"c",note:"E3",freq:164.814,type:"white"},{key:"v",note:"F3",freq:174.614,type:"white"},{key:"V",note:"F#3",freq:184.997,type:"black"},{key:"b",note:"G3",freq:196,type:"white"},{key:"B",note:"G#3",freq:207.652,type:"black"},{key:"n",note:"A3",freq:220,type:"white"},{key:"N",note:"A#3",freq:233.082,type:"black"},{key:"m",note:"B3",freq:246.942,type:"white"},{key:"a",note:"C4",freq:261.626,type:"white"},{key:"A",note:"C#4",freq:277.183,type:"black"},{key:"s",note:"D4",freq:293.665,type:"white"},{key:"S",note:"D#4",freq:311.127,type:"black"},{key:"d",note:"E4",freq:329.628,type:"white"},{key:"f",note:"F4",freq:349.228,type:"white"},{key:"F",note:"F#4",freq:369.994,type:"black"},{key:"g",note:"G4",freq:392,type:"white"},{key:"G",note:"G#4",freq:415.305,type:"black"},{key:"h",note:"A4",freq:440,type:"white"},{key:"H",note:"A#4",freq:466.164,type:"black"},{key:"j",note:"B4",freq:493.883,type:"white"},{key:"q",note:"C5",freq:523.251,type:"white"},{key:"Q",note:"C#5",freq:554.365,type:"black"},{key:"w",note:"D5",freq:587.33,type:"white"},{key:"W",note:"D#5",freq:622.254,type:"black"},{key:"e",note:"E5",freq:659.255,type:"white"},{key:"r",note:"F5",freq:698.456,type:"white"},{key:"R",note:"F#5",freq:739.989,type:"black"},{key:"t",note:"G5",freq:783.991,type:"white"},{key:"T",note:"G#5",freq:830.609,type:"black"},{key:"y",note:"A5",freq:880,type:"white"},{key:"Y",note:"A#5",freq:932.328,type:"black"},{key:"u",note:"B5",freq:987.767,type:"black"},{key:"1",note:"C6",freq:1046.502,type:"white"},{key:"",note:"C#6",freq:1108.731,type:"black"},{key:"2",note:"D6",freq:1174.659,type:"white"},{key:"",note:"D#6",freq:1244.508,type:"black"},{key:"3",note:"E6",freq:1318.51,type:"white"},{key:"4",note:"F6",freq:1396.913,type:"white"},{key:"",note:"F#6",freq:1479.978,type:"black"},{key:"5",note:"G6",freq:1567.982,type:"white"},{key:"",note:"G#6",freq:1661.219,type:"black"},{key:"6",note:"A6",freq:1760,type:"white"},{key:"",note:"A#6",freq:1864.655,type:"black"},{key:"7",note:"B6",freq:1975.533,type:"white"},{key:"",note:"C7",freq:2093.005,type:"white"},{key:"",note:"C#7",freq:2217.461,type:"black"},{key:"",note:"D7",freq:2349.318,type:"white"},{key:"",note:"D#7",freq:2489.016,type:"black"},{key:"",note:"E7",freq:2637.02,type:"white"},{key:"",note:"F7",freq:2793.826,type:"white"},{key:"",note:"F#7",freq:2959.955,type:"black"},{key:"",note:"G7",freq:3135.964,type:"white"},{key:"",note:"G#7",freq:3322.438,type:"black"},{key:"",note:"A7",freq:3520,type:"white"},{key:"",note:"A#7",freq:3729.31,type:"black"},{key:"",note:"B7",freq:3951.066,type:"white"}],rt=[B.slice(24,30),B.slice(30,36),B.slice(36,42),B.slice(42,48),B.slice(48,54),B.slice(54,60),B.slice(60,66),B.slice(66,72)],ct=[B.slice(0,12),B.slice(12,24),B.slice(24,36),B.slice(36,48),B.slice(48,60),B.slice(60,72),B.slice(72,84)],Qe=window.innerHeight>window.innerWidth,N=Qe?rt:ct,I={},L={};document.addEventListener("fullscreenchange",function(){var e=!!document.fullscreenElement;t.style.display=e?"none":"block",a.style.display=e?"block":"none"}),document.addEventListener("webkitfullscreenchange",function(){var e=!!document.webkitFullscreenElement;t.style.display=e?"none":"block",a.style.display=e?"block":"none"}),document.addEventListener("mozfullscreenchange",function(){var e=!!document.mozFullScreenElement;t.style.display=e?"none":"block",a.style.display=e?"block":"none"}),document.addEventListener("MSFullscreenChange",function(){var e=!!document.msFullscreenElement;t.style.display=e?"none":"block",a.style.display=e?"block":"none"}),F()})</script></head><body><div class="app-container"><div id="control-bar" class="control-bar"><button id="record-button" title="Record / Stop and Save WAV"><div id="record-indicator"></div></button> <button id="play-button" title="Play / Stop Melody"><svg id="play-icon" class="icon" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg> <svg id="stop-icon" class="icon" viewBox="0 0 24 24" style="display:none"><path d="M6 6h12v12H6z"/></svg></button><div class="instrument-selector"><button id="instrument-button" title="Select Instrument"><svg class="icon" viewBox="0 0 24 24"><path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/></svg></button><div id="instrument-dropdown" class="instrument-dropdown"><!-- Instrument options will be populated by JavaScript --></div></div><div class="wave-selector"><div class="wave-option" data-wave-type="sine" title="Sine Wave"><svg viewBox="0 0 60 30"><path d="M0,15 Q7.5,5 15,15 T30,15 T45,15 T60,15"/></svg></div><div class="wave-option" data-wave-type="square" title="Square Wave"><svg viewBox="0 0 60 30"><path d="M5,22 L15,22 L15,8 L45,8 L45,22 L55,22"/></svg></div><div class="wave-option" data-wave-type="sawtooth" title="Sawtooth Wave"><svg viewBox="0 0 60 30"><path d="M0,22 L30,8 L30,22 L60,8"/></svg></div><div class="wave-option" data-wave-type="triangle" title="Triangle Wave"><svg viewBox="0 0 60 30"><path d="M0,22 L15,8 L30,22 L45,8 L60,22"/></svg></div></div><input type="range" id="volume-slider" min="0" max="1" value="0.5" step="0.01" title="Volume"> <button id="fullscreen-button" title="Toggle Fullscreen"><svg id="fullscreen-enter-icon" class="icon" viewBox="0 0 24 24"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg> <svg id="fullscreen-exit-icon" class="icon" viewBox="0 0 24 24" style="display:none"><path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/></svg></button></div><div class="hexboard-container"><div id="hexboard" class="hexboard"><!-- SVG piano will be generated here --></div></div><!-- Melody Panel --><div id="overlay-panel" class="overlay-panel"><button id="panel-close-btn" class="close-btn">Ã—</button><div class="panel-header"><h2>Recorded Melody</h2></div><div id="panel-content" class="panel-content"><!-- Notes will be displayed here --></div><div class="panel-buttons"><button id="import-json-btn" class="panel-button">Import JSON</button> <button id="import-audio-btn" class="panel-button">Import Audio</button> <button id="export-json-btn" class="panel-button">Export JSON</button> <button id="export-audio-btn" class="panel-button">Export Audio</button> <input type="file" id="file-input" accept=".json" style="display:none"> <input type="file" id="audio-file-input" accept="audio/*" style="display:none"></div></div><!-- Progress Bar for Audio Conversion --><div id="progress-container" class="progress-container"><div id="progress-text" class="progress-text">Processing...</div><div class="progress-bar"><div id="progress-fill" class="progress-fill"></div></div></div></div></body></html>
